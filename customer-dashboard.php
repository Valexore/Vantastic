<?php
session_start();
require __DIR__ . '/vendor/autoload.php'; // Add this line
// Verify login
if (!isset($_SESSION['user_id'])) {
  header("Location: index.php");
  exit();
}

// Database connection
include 'config.php';

// Get user data
$user_id = $_SESSION['user_id'];
$query = "SELECT * FROM users WHERE id = $user_id";
$result = mysqli_query($conn, $query);
$user = mysqli_fetch_assoc($result);

if (!$user) {
  session_destroy();
  header("Location: index.php");
  exit();
}

// Get terminals and destinations
$terminals = [];
$destinations = [];
$terminals_result = mysqli_query($conn, "SELECT * FROM terminals");
$destinations_result = mysqli_query($conn, "SELECT * FROM destinations");

while ($row = mysqli_fetch_assoc($terminals_result)) {
  $terminals[] = $row;
}

while ($row = mysqli_fetch_assoc($destinations_result)) {
  $destinations[] = $row;
}

// Get ticket history
$ticket_history = [];
$history_query = "SELECT t.*, ter.name as terminal_name, des.name as destination_name, r.stars, r.comment 
                 FROM tickets t
                 JOIN terminals ter ON t.terminal_id = ter.id
                 JOIN destinations des ON t.destination_id = des.id
                 LEFT JOIN ratings r ON r.ticket_id = t.id
                 WHERE t.user_id = $user_id
                 ORDER BY t.travel_date DESC, t.travel_time DESC";
$history_result = mysqli_query($conn, $history_query);

while ($row = mysqli_fetch_assoc($history_result)) {
  $ticket_history[] = $row;
}

// Handle form submission
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['book_ticket'])) {
  $terminal_id = (int)$_POST['terminal'];
  $destination_id = (int)$_POST['destination'];
  $travel_date = mysqli_real_escape_string($conn, $_POST['date']);
  $travel_time = mysqli_real_escape_string($conn, $_POST['time']);
  $passenger_count = (int)$_POST['passenger_count'];
  $baggage_count = (int)$_POST['baggage_count'];
  $payment_method = mysqli_real_escape_string($conn, $_POST['payment_method']);
  $has_discount = isset($_POST['has_discount']) ? 1 : 0;
  $discounted_passengers = $has_discount ? (int)$_POST['discounted_passengers'] : 0;

  // Get base fare
  $fare_query = "SELECT base_fare FROM destinations WHERE id = $destination_id";
  $fare_result = mysqli_query($conn, $fare_query);
  $fare_data = mysqli_fetch_assoc($fare_result);
  $base_fare = $fare_data['base_fare'];

  // Calculate total
  $baggage_fee = $baggage_count * 10; // 10 pesos per kg
  $service_fee = 0;
  $discount_amount = $discounted_passengers * 30; // 30 pesos discount per passenger
  $total_amount = ($base_fare * $passenger_count) + $baggage_fee + $service_fee - $discount_amount;

  // Insert ticket
  $insert_query = "INSERT INTO tickets (user_id, terminal_id, destination_id, passenger_count, baggage_count, 
travel_date, travel_time, payment_method, total_amount, discount_amount)
VALUES ($user_id, $terminal_id, $destination_id, $passenger_count, $baggage_count,
'$travel_date', '$travel_time', '$payment_method', $total_amount, $discount_amount)";

  if (mysqli_query($conn, $insert_query)) {
    $ticket_id = mysqli_insert_id($conn);
    $_SESSION['success_message'] = "";
    // Generate unique barcode
        $barcode_value = 'VT' . str_pad($ticket_id, 6, '0', STR_PAD_LEFT) . '-' . bin2hex(random_bytes(3));
        
        // Insert barcode into ticket_barcodes table
        $barcode_query = "INSERT INTO ticket_barcodes (ticket_id, barcode_value) 
                         VALUES ($ticket_id, '$barcode_value')";
        mysqli_query($conn, $barcode_query);
        
        header("Location: customer-dashboard.php#ticket-history");
        exit();
  } else {
    // Store the error in session
    $_SESSION['error_message'] = "Error booking ticket: " . mysqli_error($conn);
    // Redirect back to the form page
    header("Location: booking-page.php"); // Change this to your actual form page
    exit();
  }
}

// Handle rating submission
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['submit_rating'])) {
  $ticket_id = (int)$_POST['ticket_id'];
  $stars = (int)$_POST['stars'];
  $comment = mysqli_real_escape_string($conn, $_POST['comment']);

  // Check if rating already exists
  $check_query = "SELECT id FROM ratings WHERE ticket_id = $ticket_id";
  $check_result = mysqli_query($conn, $check_query);

  if (mysqli_num_rows($check_result) > 0) {
    $_SESSION['error_message'] = "You have already rated this trip.";
    header("Location: customer-dashboard.php#ticket-history");
    exit();
  } else {
    $insert_rating = "INSERT INTO ratings (ticket_id, stars, comment) 
                     VALUES ($ticket_id, $stars, '$comment')";

    if (mysqli_query($conn, $insert_rating)) {
      $_SESSION['success_message'] = "Thank you for your rating!";
      header("Location: customer-dashboard.php#ticket-history");
      exit();
    } else {
      $_SESSION['error_message'] = "Error submitting rating: " . mysqli_error($conn);
      header("Location: customer-dashboard.php#ticket-history");
      exit();
    }
  }
}
?>

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="img/knorr.png" type="image/png">
  <title>Customer Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link rel="stylesheet" href="costumer.css?v=<?php echo time(); ?>">
  <link rel="stylesheet" href="chatbotandWeather.css?v=<?php echo time(); ?>">
  <link rel="stylesheet" href="scrollStyle.css?v=<?php echo time(); ?>">
  <link rel="stylesheet" href="costumer.css">
</head>

<body>
  <header>
    <div class="logo">
      <h1><a href="#"><img src="img/VanTastic.png" alt="Van Terminal System"></a></h1>
    </div>
    <div class="menu-toggle" id="mobile-menu">
      <span class="bar"></span>
      <span class="bar"></span>
      <span class="bar"></span>
    </div>
    <nav id="nav-menu">
      <ul>
        <li><a href="#ticket-ordering">Book Now!</a></li>
        <li><a href="#weather-traffic">Weather & Traffic</a></li>
        <li><a href="#ticket-history">History & Rate</a></li>
        <li class="logout-item">
          <a href="#" class="login" id="logout-trigger"><i class="fas fa-sign-out-alt"></i> Log Out</a>
        </li>
      </ul>
    </nav>
  </header>

  <!-- Custom Dialog (add before closing body tag) -->
  <div id="logout-dialog" class="logout-dialog">
    <div class="dialog-content">
      <div class="dialog-header">
        <i class="fas fa-sign-out-alt"></i>
        <h3>Ready to Leave?</h3>
      </div>
      <div class="dialog-body">
        <p>Are you sure you want to log out?</p>
      </div>
      <div class="dialog-footer">
        <button id="logout-cancel" class="dialog-btn cancel-btn">Cancel</button>
        <button id="logout-confirm" class="dialog-btn confirm-btn">Log Out</button>
      </div>
    </div>
  </div>

  <!-- Popup Modal -->
  <div class="modal-overlay" id="messageModal">
    <div class="modal-content">
      <div id="loadingState">
        <div class="loading-spinner"></div>
        <div class="loading-text">Processing...</div>
      </div>
      <div id="messageState" style="display: none;">
        <div class="modal-icon">
          <i class="fas fa-check-circle"></i>
        </div>
        <h3 class="modal-title" id="modalTitle">Success!</h3>
        <p class="modal-message" id="modalMessage"></p>
        <button class="modal-button" id="modalButton">OK</button>
      </div>
    </div>
  </div>

  <?php if (isset($_SESSION['success_message'])): ?>
    <div class="alert alert-success">
      <?php echo $_SESSION['success_message'];
      unset($_SESSION['success_message']); ?>
    </div>
  <?php endif; ?>

  <?php if (isset($_SESSION['error_message'])): ?>
    <div class="alert alert-error">
      <?php echo $_SESSION['error_message'];
      unset($_SESSION['error_message']); ?>
    </div>
  <?php endif; ?>
  <br>
  
  <div class="main-content">
    <!-- Left side for your SVG -->
    <div class="svg-container">
      <!-- Your SVG will go here -->
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 500 500">
        <g id="freepik--background-complete--inject-68">
          <rect y="382.4" width="500" height="0.25" style="fill:#ebebeb"></rect>
          <rect x="416.78" y="398.49" width="33.12" height="0.25" style="fill:#ebebeb"></rect>
          <rect x="322.53" y="401.21" width="8.69" height="0.25" style="fill:#ebebeb"></rect>
          <rect x="396.59" y="389.21" width="19.19" height="0.25" style="fill:#ebebeb"></rect>
          <rect x="52.46" y="390.89" width="43.19" height="0.25" style="fill:#ebebeb"></rect>
          <rect x="104.56" y="390.89" width="6.33" height="0.25" style="fill:#ebebeb"></rect>
          <rect x="131.47" y="395.11" width="93.68" height="0.25" style="fill:#ebebeb"></rect>
          <path d="M237,337.8H43.91a5.71,5.71,0,0,1-5.7-5.71V60.66A5.71,5.71,0,0,1,43.91,55H237a5.71,5.71,0,0,1,5.71,5.71V332.09A5.71,5.71,0,0,1,237,337.8ZM43.91,55.2a5.46,5.46,0,0,0-5.45,5.46V332.09a5.46,5.46,0,0,0,5.45,5.46H237a5.47,5.47,0,0,0,5.46-5.46V60.66A5.47,5.47,0,0,0,237,55.2Z" style="fill:#ebebeb"></path>
          <path d="M453.31,337.8H260.21a5.72,5.72,0,0,1-5.71-5.71V60.66A5.72,5.72,0,0,1,260.21,55h193.1A5.71,5.71,0,0,1,459,60.66V332.09A5.71,5.71,0,0,1,453.31,337.8ZM260.21,55.2a5.47,5.47,0,0,0-5.46,5.46V332.09a5.47,5.47,0,0,0,5.46,5.46h193.1a5.47,5.47,0,0,0,5.46-5.46V60.66a5.47,5.47,0,0,0-5.46-5.46Z" style="fill:#ebebeb"></path>
          <circle cx="335.4" cy="148.29" r="41.55" style="fill:#f5f5f5"></circle>
          <path d="M409.55,140.1a6.77,6.77,0,0,0-6.77-6.77,6.5,6.5,0,0,0-1.94.29,15.79,15.79,0,0,0,.15-2.08,14.31,14.31,0,0,0-17-14.08,12.53,12.53,0,0,0-23.23,6.33h-.21a11.55,11.55,0,0,0,0,23.09H403A6.77,6.77,0,0,0,409.55,140.1Z" style="fill:#ebebeb"></path>
          <path d="M302.61,177.34a6.77,6.77,0,0,0-6.76-6.77,6.62,6.62,0,0,0-2,.29,14.28,14.28,0,0,0-14.18-16.41,14.41,14.41,0,0,0-2.64.25A12.52,12.52,0,0,0,253.86,161h-.21a11.55,11.55,0,0,0,0,23.09H296A6.76,6.76,0,0,0,302.61,177.34Z" style="fill:#ebebeb"></path>
          <path d="M116,190.15a6.77,6.77,0,0,0-6.76-6.77,7,7,0,0,0-2,.28,14.1,14.1,0,0,0,.16-2.07,14.37,14.37,0,0,0-17-14.09,12.52,12.52,0,0,0-23.22,6.34l-.21,0a11.55,11.55,0,0,0,0,23.09h42.39A6.75,6.75,0,0,0,116,190.15Z" style="fill:#ebebeb"></path>
          <path d="M405.64,222.44a4.09,4.09,0,0,0-4.09-4.09,4.16,4.16,0,0,0-1.18.17,8.67,8.67,0,0,0-8.57-9.92,8.32,8.32,0,0,0-1.59.15,7.57,7.57,0,0,0-14,3.83H376a7,7,0,0,0,0,14h25.62A4.08,4.08,0,0,0,405.64,222.44Z" style="fill:#ebebeb"></path>
          <path d="M158.43,90.91A4.06,4.06,0,0,0,153.17,87a8.67,8.67,0,0,0-8.57-9.92,8.43,8.43,0,0,0-1.6.15,7.57,7.57,0,0,0-14,3.83h-.12a7,7,0,1,0,0,14h25.62A4.09,4.09,0,0,0,158.43,90.91Z" style="fill:#ebebeb"></path>
          <polygon points="89.86 243.66 116.94 366.67 121.86 364.36 93.42 242.97 89.86 243.66" style="fill:#ebebeb"></polygon>
          <path d="M400.78,366.08S384,250.5,421.72,131l-5.91-4.56s-44.16,90.4-37.73,242.92Z" style="fill:#e6e6e6"></path>
          <path d="M432,99.58c13.82-9.06,34.27,5.35,37.08,27.87a43.07,43.07,0,0,0-6.35-3c-1.07-5.67-2.1-10.68-2.1-10.68l.74,10.17c-1.22-.44-2.55-.87-4-1.26l-1-5.47-.45,5.11a48.13,48.13,0,0,0-5.94-1l-2.58-16L446.1,121a42.79,42.79,0,0,0-6.13.27l-1.58-10.86v11.08a40.54,40.54,0,0,0-5.18,1.19l-1.89-16.2s.05,9.11-.05,16.84a42.36,42.36,0,0,0-13.34,7.84l-.15-2S419.37,107.84,432,99.58Z" style="fill:#e0e0e0"></path>
          <path d="M412.89,92.34c-11-12.35-34.48-3.79-43.07,17.21a42.2,42.2,0,0,1,6.91-1.25c2.51-5.19,4.82-9.76,4.82-9.76l-3.37,9.62c1.29-.1,2.68-.16,4.17-.16l2.35-5-.9,5.05a48.19,48.19,0,0,1,6,.54l6.67-14.74-2.82,15.5a41.18,41.18,0,0,1,5.85,1.86l4.37-10.07L401,111.8a37.44,37.44,0,0,1,4.69,2.51l6.07-15.15s-2.44,8.78-4.36,16.26a42.35,42.35,0,0,1,10.82,11.07l.67-1.89S422.9,103.62,412.89,92.34Z" style="fill:#e0e0e0"></path>
          <path d="M402.32,121.63c11-10.73,19.26-1.39,19.26-1.39-4.13,1.07-7.82,3.72-11,7.09l-1.49-1.94.24,3.31c-.76.88-1.5,1.8-2.21,2.75l-2.52-5.73,1.08,7.76c-1,1.48-2,3-2.83,4.52l-1.11-5.68.09,7.53c-.92,1.7-1.74,3.37-2.47,4.94l-1.2-10.43L398,147.85c-1.76,4.16-2.68,7.08-2.68,7.08S391.32,132.37,402.32,121.63Z" style="fill:#e0e0e0"></path>
          <path d="M432,147l-2.27,1.31c-.33-1.75-.72-3.58-1.15-5.44l1.54-2.83-1.94,1.2c-.15-.62-.32-1.23-.48-1.85l2-5.54-3,2.21c-1.6-5-3.64-9.39-6.19-11.49,0,0,25.22,8.06,11,35.25,0,0-.46-4.3-1.47-9.95Z" style="fill:#e0e0e0"></path>
          <path d="M407.2,124.75l-4-7.6,1.66,7.92c-.4.06-.81.14-1.22.22l-5.23-6.51,1.29,7.49a46.72,46.72,0,0,0-5.25,1.94A59.16,59.16,0,0,0,389,131l-2.55-6.65,1.19,7.44c-1.73,1-3.42,2.13-5,3.27l-1.26-5.86.12,6.67c-2,1.44-3.86,2.9-5.58,4.33l.16-10.62-1.55,11.79c-1.76,1.5-3.35,2.94-4.7,4.22l-.19-7.37-1.87,9.36c-1.94,1.93-3.05,3.16-3.05,3.16,1-25.79,11-36,27.54-38.8s28.46,14.41,28.46,14.41S415.58,123.91,407.2,124.75Z" style="fill:#e0e0e0"></path>
          <path d="M455.44,156.27,453.93,164c-.73-1.91-1.72-4.36-3-7.09l1.36-11.25-2.48,8.87a87.13,87.13,0,0,0-6.72-11.6l2.36-7.8-3.82,5.79c-.77-1-1.56-2-2.38-2.92l1.34-4.91-2.07,4.11c-.56-.62-1.14-1.21-1.73-1.78l1.63-6.55-2.59,5.67a28.64,28.64,0,0,0-5.29-3.83l2.63-8-4.12,7.26a18.35,18.35,0,0,0-8.29-1.73s5-8,14.19-10.75,29,13.89,20.4,50.6c0,0-.26-.83-.78-2.26Z" style="fill:#e0e0e0"></path>
          <path d="M440.28,84.94l1.57,4.66a9.91,9.91,0,0,0-1.72.25l-1.89-6.07L439.5,90a13.65,13.65,0,0,0-3.4,1.55l-2.6-8.19L435,92.29c-.42.31-.84.65-1.27,1l-2.94-7.69L433,94a32.67,32.67,0,0,0-5.51,7.34L426.72,90l-1.3,15.39a92.39,92.39,0,0,0-5.2,14.91s-1.6-41,8.27-45.6,15.74,15.09,15.74,15.09a5.49,5.49,0,0,0-1.35-.22Z" style="fill:#e0e0e0"></path>
          <path d="M426.18,130.55l-.88,7.77-3-7.49-4,5.86-1.58-5.46-4.62,3.88s.57-9.91,3.52-14.44S427.43,119.32,426.18,130.55Z" style="fill:#e0e0e0"></path>
          <path d="M303,255.49V201.31S292,213,284.73,211.4,268,215.33,268,215.33s9.53-1.39,13.07,2.48,19.34,4.28,19.34,4.28v35.38Z" style="fill:#ebebeb"></path>
          <polygon points="351.5 238.88 349 238.88 349 242.29 340.76 242.29 340.76 238.88 332.66 238.88 332.66 242.29 324.42 242.29 324.42 238.88 316.33 238.88 316.33 242.29 308.08 242.29 308.08 238.88 299.99 238.88 299.99 242.29 291.75 242.29 291.75 238.88 283.65 238.88 283.65 242.29 275.41 242.29 275.41 238.88 267.31 238.88 267.31 242.29 259.07 242.29 259.07 238.88 256.3 238.88 248.27 303.08 359.8 302.62 351.5 238.88" style="fill:#e0e0e0"></polygon>
          <polygon points="369.24 285.48 365.81 285.48 365.81 290.16 354.49 290.16 354.49 285.48 343.37 285.48 343.37 290.16 332.04 290.16 332.04 285.48 320.92 285.48 320.92 290.16 309.6 290.16 309.6 285.48 298.48 285.48 298.48 290.16 287.15 290.16 287.15 285.48 276.03 285.48 276.03 290.16 264.7 290.16 264.7 285.48 253.58 285.48 253.58 290.16 242.26 290.16 242.26 285.48 238.45 285.48 227.41 373.69 380.66 373.05 369.24 285.48" style="fill:#ebebeb"></polygon>
          <path d="M425.85,363.3c-2.37-2.67-4.6-5.4-7.08-8a3.19,3.19,0,0,1-.35-.42,21.14,21.14,0,0,0-2.55-1.41c-.16-.05-.68-.26-1.21-.46-1-.36-2-.75-3-1.15-6.21-2.5-11.79-5.4-16.48-10.33-2.57-2.7-4.62-5.85-7.28-8.47-.07.09-.59-.19-.84-.39l-2-.26c-1.07,0-2.15,0-3.22.07-1.53.07-3.06.19-4.59.33-6,8.72-13.5,20.63-16.82,22.2-5.15,2.44-52.61,15-56.11,14.23s-21.82.74-26.42.57-12.93-2.21-25-7.76-18.65-5.58-33.18-10.21-24.27-6.39-32.77.73-31.85-7.91-39.13-10.05-21.2-14.47-30.7-8.72-17.4,8.49-29.27,18.77-35.42,30.15-35.42,30.15h401l-4.61-8.05A33,33,0,0,1,425.85,363.3Z" style="fill:#f5f5f5"></path>
          <path d="M43.18,265s11.67-21,43.29-39.12c0,0,25.74-2.19,54.8,10.48,0,0,5.89,9.78-.81,13.64s-12.25-3.9-12.25-3.9-1.24,11.82-10,12.16-11.3-8.26-11.3-8.26-.86,10.85-11.29,13.59C86.6,266,81,258.26,81,258.26s-1.8,8.92-9.91,11.49c-6.52,2.06-11-3.55-11-3.55s-1.87,9.68-8.79,9.68C45.35,275.88,43.18,265,43.18,265Z" style="fill:#e0e0e0"></path>
        </g>
        <g id="freepik--Shadow--inject-68">
          <ellipse id="freepik--path--inject-68" cx="250" cy="416.24" rx="193.89" ry="11.32" style="fill:#f5f5f5"></ellipse>
        </g>
        <g id="freepik--Sand--inject-68">
          <path d="M384,366.91s4.35-6.37,8.31-8.15,4.6-8.55,6.75-8.92,4.52,5.87,8.28,7.69,9.45,9.34,9.45,9.34Z" style="fill:#0E386A"></path>
          <path d="M384,366.91s4.35-6.37,8.31-8.15,4.6-8.55,6.75-8.92,4.52,5.87,8.28,7.69,9.45,9.34,9.45,9.34Z" style="fill:#fff;opacity:0.8;isolation:isolate"></path>
          <polygon points="415.62 412.77 383.98 412.77 379.98 366.87 419.62 366.87 415.62 412.77" style="fill:#0E386A"></polygon>
          <rect x="378.06" y="364.49" width="43.47" height="4.83" style="fill:#0E386A"></rect>
          <rect x="378.06" y="364.49" width="43.47" height="4.83" style="fill:#fff;opacity:0.2;isolation:isolate"></rect>
          <path d="M397.93,367.89c2.88,4.52,15.21,23.17,22.85,24.53l.94-2.26s-6.84.82-22-23.41a1.08,1.08,0,0,0-1.43-.39h0A1.07,1.07,0,0,0,397.93,367.89Z" style="fill:#263238"></path>
          <path d="M352.91,353.41h0a2.55,2.55,0,0,1,3.22,1.73l5.4,18.89,7-2.81s4.23,15.75-3.76,18.24C357,391.89,351,377.35,351,377.35l7.14-2-6.82-18.66A2.55,2.55,0,0,1,352.91,353.41Z" style="fill:#0E386A"></path>
          <path d="M364.8,389.46C357,391.89,351,377.35,351,377.35l7.14-2s1.23,2.1,2.61,1.58.82-2.93.82-2.93l7-2.81S372.79,387,364.8,389.46Z" style="fill:#fff;opacity:0.4;isolation:isolate"></path>
          <path d="M424.67,416.65c-3.93-1.95-7.95-3.79-9.24-3.88-2.76-.18-4.35-1.41-6.32-3.76s-2.77-5.07-6.33-8.85.39-5.3-7.13-6.27-4.61-.36-9.23-3.69-3.68-3.32-9.09-5.7-2.25-3.28-8.58-3.81c-4.37-.37-11.28,1.93-14.87,4.49-1.59,1.13-2.4,3-4,4-1.77,1.13-4.52-1-4.23,2.81a9.78,9.78,0,0,1,.13,2.95c-.51,2.14-9.32,2.13-11.56,2.8a2.16,2.16,0,0,0-1.34.82c-.51.91.26,2.52-.73,2.85-.31.11-.66,0-1,.05-1.19.23-.88,2.37-2,2.86s-2.41-.51-3.65,0c-.95.36-1.27,1.64-2.1,2.15-1.45.88-2.95,1.53-4.38,2.47-2.48,1.62-4.63,3.61-7.29,5l-7.12,1.94-2.13.75Z" style="fill:#0E386A"></path>
          <path d="M424.67,416.65c-3.93-1.95-7.95-3.79-9.24-3.88-2.76-.18-4.35-1.41-6.32-3.76s-2.77-5.07-6.33-8.85.39-5.3-7.13-6.27-4.61-.36-9.23-3.69-3.68-3.32-9.09-5.7-2.25-3.28-8.58-3.81c-4.37-.37-11.28,1.93-14.87,4.49-1.59,1.13-2.4,3-4,4-1.77,1.13-4.52-1-4.23,2.81a9.78,9.78,0,0,1,.13,2.95c-.51,2.14-9.32,2.13-11.56,2.8a2.16,2.16,0,0,0-1.34.82c-.51.91.26,2.52-.73,2.85-.31.11-.66,0-1,.05-1.19.23-.88,2.37-2,2.86s-2.41-.51-3.65,0c-.95.36-1.27,1.64-2.1,2.15-1.45.88-2.95,1.53-4.38,2.47-2.48,1.62-4.63,3.61-7.29,5l-7.12,1.94-2.13.75Z" style="fill:#fff;opacity:0.8;isolation:isolate"></path>
          <path d="M340.75,398.45a1.62,1.62,0,0,1,0,.22h0a18,18,0,0,1-2.84,9.55c-.15.23-.3.46-.47.69a18.21,18.21,0,0,1-3.76,3.93,11.88,11.88,0,0,1-1,.73h0a1.75,1.75,0,0,1-.25.16l-.33.21a5.74,5.74,0,0,1-.53.32c-.28.16-.57.32-.86.46h0A18.14,18.14,0,0,1,309.39,411a17.68,17.68,0,0,1-3.05-4.27,18.09,18.09,0,0,1-2-8.29v-.06c0-.51,0-1,.07-1.52a17.9,17.9,0,0,1,1.93-6.72,16.42,16.42,0,0,1,.88-1.53,18.54,18.54,0,0,1,3.84-4.3,15.68,15.68,0,0,1,1.49-1.08,6.65,6.65,0,0,1,.56-.36,17.8,17.8,0,0,1,4.6-2l.42-.11a18.32,18.32,0,0,1,4.42-.54q.7,0,1.38.06l.35,0h0a17.92,17.92,0,0,1,5.84,1.58l.23.11a18.16,18.16,0,0,1,10.23,14v0A17,17,0,0,1,340.75,398.45Z" style="fill:#0E386A"></path>
          <path d="M340.75,398.45a18.16,18.16,0,0,1-10.08,16.28h0a3.82,3.82,0,0,1-1-1.23c3.36-9.8,0-15.05,0-15.05v-.1l.24-1.57,0-.29c.52-2.91,1.83-8.36,4.67-11.66A18.17,18.17,0,0,1,340.75,398.45Z" style="fill:#fff;opacity:0.6000000000000001;isolation:isolate"></path>
          <path d="M308.59,395.3s-3.19,3.19-2.25,11.44a18.2,18.2,0,0,1,4.72-22.42A21.92,21.92,0,0,0,308.59,395.3Z" style="fill:#fff;opacity:0.6000000000000001;isolation:isolate"></path>
          <path d="M334.63,384.83c-4,4.64-5,13.62-5,13.62-11,2.69-21.07-3.15-21.07-3.15a22,22,0,0,1,2.47-11,18.2,18.2,0,0,1,23.57.51Z" style="fill:#fff;opacity:0.2;isolation:isolate"></path>
          <path d="M330.66,414.73A18.14,18.14,0,0,1,309.39,411c3.41,2,10.38,4.87,20.27,2.49A3.82,3.82,0,0,0,330.66,414.73Z" style="fill:#fff;opacity:0.2;isolation:isolate"></path>
          <g style="opacity:0.2;isolation:isolate">
            <path d="M330.36,382a21.37,21.37,0,0,0-1.31,2.08,32.09,32.09,0,0,0-1.91,4.28c-.56,1.47-1,3-1.4,4.49s-.74,3.06-1,4.61a32.28,32.28,0,0,1,.66-4.69,38.5,38.5,0,0,1,1.3-4.58,28.2,28.2,0,0,1,2-4.3,21.86,21.86,0,0,1,1.42-2Z"></path>
            <path d="M324.28,380.32c-.25.45-.48.91-.7,1.37a31.26,31.26,0,0,0-1.81,4.81c-.53,1.64-.93,3.32-1.31,5s-.7,3.38-1,5.08a42.73,42.73,0,0,1,.62-5.16,43.77,43.77,0,0,1,1.2-5.06,28.25,28.25,0,0,1,1.95-4.85c.22-.41.45-.82.69-1.21Z"></path>
            <path d="M318.13,380.78l-.31.81a35.51,35.51,0,0,0-1.35,4.55c-.39,1.54-.69,3.1-1,4.67s-.53,3.14-.76,4.72a40.35,40.35,0,0,1,.39-4.78A47.2,47.2,0,0,1,316,386a29.89,29.89,0,0,1,1.47-4.59c.08-.18.16-.37.25-.55Z"></path>
            <path d="M313.11,382.88c-.34,1.12-.66,2.24-.89,3.38s-.5,2.56-.7,3.85-.34,2.59-.46,3.9a27.29,27.29,0,0,1,.08-3.94,36.88,36.88,0,0,1,.59-3.91,29.39,29.39,0,0,1,.82-2.92A6.65,6.65,0,0,1,313.11,382.88Z"></path>
            <path d="M334.78,404.52a17.82,17.82,0,0,1-.73,5.57,18.83,18.83,0,0,1-1,2.63c-.13.29-.28.58-.43.86h0a1.75,1.75,0,0,1-.25.16,21,21,0,0,0,1.29-3.75,18.65,18.65,0,0,0,.6-5.46,20,20,0,0,0-.84-5.43,22.26,22.26,0,0,0-2.2-5.09,17.49,17.49,0,0,1,2.56,5A18.65,18.65,0,0,1,334.78,404.52Z"></path>
            <path d="M338.37,404l-.05,1.51-.21,1.5a9.87,9.87,0,0,1-.21,1.21c-.15.23-.3.46-.47.69a13,13,0,0,0,.3-1.95l.15-1.48,0-1.48a10.6,10.6,0,0,0,0-1.49c-.05-.49-.05-1-.14-1.47a21.86,21.86,0,0,0-1.47-5.73,20.32,20.32,0,0,0-2.94-5.16,17,17,0,0,1,3.29,5,21,21,0,0,1,1.62,5.82c.08.5.07,1,.11,1.51A10.88,10.88,0,0,1,338.37,404Z"></path>
            <path d="M340.75,398.45a1.62,1.62,0,0,1,0,.22l-.06-.34a26.55,26.55,0,0,0-2-6,21.68,21.68,0,0,0-3.46-5.33,18.59,18.59,0,0,1,3.8,5.16,24.77,24.77,0,0,1,1.58,3.89v0A17,17,0,0,1,340.75,398.45Z"></path>
            <path d="M307.7,392.42a14.91,14.91,0,0,0-2.05,3,19.58,19.58,0,0,0-1.31,3c0-.51,0-1,.07-1.52a15.11,15.11,0,0,1,.91-1.68A10.56,10.56,0,0,1,307.7,392.42Z"></path>
            <path d="M308.56,387.58c-.76.86-1.5,1.71-2.22,2.57a16.42,16.42,0,0,1,.88-1.53A15,15,0,0,1,308.56,387.58Z"></path>
            <path d="M308.56,399.16c1.66.64,3.34,1.2,5,1.7a48.94,48.94,0,0,0,5.16,1.23,23.56,23.56,0,0,0,10.5-.13,15.76,15.76,0,0,1-5.24,1,27.45,27.45,0,0,1-5.35-.42,38.3,38.3,0,0,1-5.18-1.36A34.9,34.9,0,0,1,308.56,399.16Z"></path>
            <path d="M308.56,403.51a44.39,44.39,0,0,0,5.12,1.68,38.11,38.11,0,0,0,5.28,1,30,30,0,0,0,5.36.25l1.34-.06,1.34-.16c.9-.06,1.76-.32,2.66-.45a22.31,22.31,0,0,1-5.32,1.06,28.26,28.26,0,0,1-5.44-.14,34.26,34.26,0,0,1-5.32-1.14A28.13,28.13,0,0,1,308.56,403.51Z"></path>
            <path d="M309,407.27a33.23,33.23,0,0,0,4.87,1.82,30.68,30.68,0,0,0,5.08,1c.86.14,1.72.16,2.58.22s1.73,0,2.6-.05a30,30,0,0,0,5.14-.74,21.72,21.72,0,0,1-5.11,1.13,23.82,23.82,0,0,1-5.27-.06,26.47,26.47,0,0,1-5.13-1.16A22.79,22.79,0,0,1,309,407.27Z"></path>
            <path d="M309.75,410.1a32.12,32.12,0,0,0,4.59,1.71,29,29,0,0,0,4.78,1A22.55,22.55,0,0,0,324,413l1.22-.09,1.2-.2c.82-.08,1.59-.36,2.4-.52a17.91,17.91,0,0,1-4.79,1.2,21.11,21.11,0,0,1-5,0,25.06,25.06,0,0,1-4.83-1.11A21.39,21.39,0,0,1,309.75,410.1Z"></path>
          </g>
        </g>
        <g id="freepik--travel-bag--inject-68">
          <path d="M113.79,369.84s3.56-5.35,9.89-5.74,11.67,7.68,11.67,7.68h-2s-5.11-5.51-8.77-5.51-7.22,4.55-7.22,4.55Z" style="fill:#263238"></path>
          <path d="M60.08,412.06c2.19-3.65,26.72-1.28,32.26-3.46l3,5.15s-4.23,2.34-11.25,1.51-17.63-1.05-20.4,1.39Z" style="fill:#263238"></path>
          <path d="M60.08,412.06c2.19-3.65,26.72-1.28,32.26-3.46l3,5.15s-4.23,2.34-11.25,1.51-17.63-1.05-20.4,1.39Z" style="opacity:0.30000000000000004;isolation:isolate"></path>
          <path d="M163.4,400.93c-.2.87-.42,1.72-.67,2.55-2,6.81-5.08,12.32-7.32,13.17H91.82a5.73,5.73,0,0,1-4.53-2.22l-.05-.07a5,5,0,0,1-.59-1c-4.39-9.17-8.82-27.51-2.59-35.87a13.9,13.9,0,0,1,2.24-2.36l.18-.14a18.73,18.73,0,0,1,4.34-2.65h.05c4.38-2,9.76-2.89,15-3.28,1.53-.12,3-.19,4.54-.22,3.9-.11,7.54,0,10.44.07,10.22.26,18.26,3.3,23.74,2.77a16.45,16.45,0,0,1,6,.48,17,17,0,0,1,1.66.56,26.8,26.8,0,0,1,6.88,4.23C165.39,381.92,165.48,392.11,163.4,400.93Z" style="fill:#263238"></path>
          <path d="M163.4,400.93c-.2.87-.42,1.72-.67,2.55-2,6.81-5.08,12.32-7.32,13.17H91.82a5.73,5.73,0,0,1-4.53-2.22l-.05-.07a5,5,0,0,1-.59-1c-4.39-9.17-8.82-27.51-2.59-35.87a13.9,13.9,0,0,1,2.24-2.36l.18-.14a18.73,18.73,0,0,1,4.34-2.65h.05c4.38-2,9.76-2.89,15-3.28,1.53-.12,3-.19,4.54-.22,3.9-.11,7.54,0,10.44.07,10.22.26,18.26,3.3,23.74,2.77a16.45,16.45,0,0,1,6,.48,17,17,0,0,1,1.66.56,26.8,26.8,0,0,1,6.88,4.23C165.39,381.92,165.48,392.11,163.4,400.93Z" style="fill:#fff;opacity:0.1;isolation:isolate"></path>
          <path d="M153.66,400.3c-4.55,0-13.65,2.17-27.1-.79a42.61,42.61,0,0,0-19.09-.14c-.15-2-.31-4.23-.49-6.65-1.19-16.25-10.46-23.07-16.11-20.37h-.05A25,25,0,0,0,86.48,375l-.18.14a13.9,13.9,0,0,0-2.24,2.36c-6.23,8.36-1.8,26.7,2.59,35.87a5,5,0,0,0,.59,1l.05.07a5.76,5.76,0,0,0,4.32,1.95H103c4.65,0,5.2-4.26,4.68-13.41.79-.45,1.76-1,2.84-1.74,2.83-1.84,13.84-.93,18.59.85s17.21,2.57,23.24,1.59a40.28,40.28,0,0,1,10.36-.19c.25-.83.47-1.68.67-2.55C161.32,400.71,157,400.3,153.66,400.3Z" style="opacity:0.2;isolation:isolate"></path>
          <path d="M112.32,377.35c2.77,10.09,4.67,13.65,5.4,14.64s20.87,3.38,24.65,3.37a73.18,73.18,0,0,0,13-1.28c2.57-.65,3.4-13.59-3.08-21.35a17,17,0,0,0-1.66-.56c3.53,7.92,3.61,17.62,3.19,19-.6,1.92-6.53,1.64-9.3,1.58s-20-1.13-21.76-1.83a9.13,9.13,0,0,1-4.15-3.45c-1.39-1.78-1.58-7.91-4.09-13.2a20.76,20.76,0,0,0-4.11-5.39c-1.49,0-3,.1-4.54.22A13.19,13.19,0,0,1,112.32,377.35Z" style="opacity:0.2;isolation:isolate"></path>
          <path d="M92.34,386.64,86.8,388s-3.93,11.28-1.58,16-16,11.29-25.14,8l3.58,4.59s21.76-1.37,25.91-9.65-1.78-9.56-2.17-11.89S92.34,386.64,92.34,386.64Z" style="fill:#263238"></path>
          <path d="M92.34,386.64,86.8,388s-3.93,11.28-1.58,16-16,11.29-25.14,8l3.58,4.59s21.76-1.37,25.91-9.65-1.78-9.56-2.17-11.89S92.34,386.64,92.34,386.64Z" style="fill:#fff;opacity:0.1;isolation:isolate"></path>
        </g>
        <g id="freepik--Character--inject-68">
          <g id="freepik--group--inject-68">
            <path d="M141.27,154s-21.4-12-25.83-15.08-28.13-26.35-29.45-27c0,0,.88-2.66-1.11-4.21s-9.75-6.64-10.85-6.64-4,10.85-3.55,13.51,11.3,3.32,11.3,3.32,22.59,26.3,26.13,30,27.68,19.41,27.68,19.41Z" style="fill:#e4897b"></path>
            <path d="M150.05,156.21s4.69,9.47-6.7,24.51l-25.11-18.46,10-18.15Z" style="fill:#0E386A"></path>
            <path d="M143.35,180.72,131.49,172l-1.55-1.14L123.25,166l-5-3.69,3.69-6.67L124,151.8l4.25-7.69,4.1,2.28,3.54,2,14.14,7.86a11.25,11.25,0,0,1,.85,3.45C151.35,163.69,150.67,171.05,143.35,180.72Z" style="fill:#fff;opacity:0.6000000000000001;isolation:isolate"></path>
            <path d="M143.35,180.72,131.49,172c4.07-8.42,14.6-11.39,19.41-12.34C151.35,163.69,150.67,171.05,143.35,180.72Z" style="opacity:0.2;isolation:isolate"></path>
            <g style="opacity:0.2">
              <polygon points="135.91 148.35 132.37 150.41 132.37 146.39 135.91 148.35" style="fill:#fff"></polygon>
              <polygon points="128.21 153.04 123.77 159.27 121.93 155.59 124.02 151.8 128.21 153.04" style="fill:#fff"></polygon>
              <polygon points="131.49 162.41 129.94 170.86 123.25 165.95 131.49 162.41" style="fill:#fff"></polygon>
              <polygon points="134.56 157.59 137.03 163.92 142.16 156.94 134.56 157.59" style="fill:#fff"></polygon>
            </g>
            <path d="M196.72,151.73s21.4-12,25.83-15.08,28.13-26.35,29.46-27c0,0-.89-2.66,1.1-4.21s9.75-6.64,10.85-6.64,4,10.85,3.55,13.51-11.3,3.32-11.3,3.32-22.59,26.31-26.13,30S202.4,165,202.4,165Z" style="fill:#e4897b"></path>
            <path d="M171.15,278.45S170.69,286,170,296.1c-.46,6.28-1,13.53-1.65,20.54-.84,9.42-1.79,18.4-2.74,24-.87,5.13-12.42,68.84-12.42,68.84h-7.74c2.44-59.41,6.22-82.45,6.36-85.91,0-1.13.09-2.7.14-4.57.15-6.78.28-17.49.36-25.28.06-5.62.09-9.71.09-9.71Z" style="fill:#e4897b"></path>
            <path d="M201,326.52c-.27,5.19-3.36,82.68-3.36,82.68h-8.51c-4.35-61.72-2.7-83.15-3.48-87.43,0,0,0,0,0,0-1.33-7.28-2.58-16.85-3.44-24-.69-5.71-1.12-9.82-1.12-9.82l17.35-7.5s1.05,9,1.84,19.78c.39,5.4.73,11.27.83,16.73C201.19,320.38,201.17,323.64,201,326.52Z" style="fill:#e4897b"></path>
            <path d="M152.27,293.7,170,296.1c-.46,6.28-1,13.53-1.65,20.54L151.91,319C152.06,312.2,152.19,301.49,152.27,293.7Z" style="opacity:0.2;isolation:isolate"></path>
            <path d="M201.12,317l-15.46,4.76c-1.33-7.28-2.58-16.85-3.44-24l18.07,2.46C200.68,305.63,201,311.5,201.12,317Z" style="opacity:0.2;isolation:isolate"></path>
            <path d="M155,407.08H144.77a.75.75,0,0,0-.72.58l-1.65,7.48a1.24,1.24,0,0,0,.95,1.47,1.33,1.33,0,0,0,.28,0c3.3-.05,5.71-.26,9.85-.26,2.56,0,10.27.27,13.79.27s4-3.48,2.55-3.81c-6.48-1.41-11.36-3.36-13.43-5.22A2,2,0,0,0,155,407.08Z" style="fill:#0E386A"></path>
            <path d="M198.28,406.82H188.07a.73.73,0,0,0-.72.57l-1.66,7.49a1.25,1.25,0,0,0,1,1.47l.27,0c3.31-.05,5.71-.25,9.86-.25,2.55,0,10.26.26,13.79.26s4-3.48,2.54-3.8c-6.48-1.41-11.35-3.37-13.42-5.23A2,2,0,0,0,198.28,406.82Z" style="fill:#0E386A"></path>
            <path d="M171.85,312.27c.08-.68.16-1.39.24-2.19,1-10.24,2.09-22.53,3-34.37,3.45,9.28,4.94,22.33,6.74,36.56h21c-1.74-36.83-6.3-66.79-8.72-79.57H149.57c-.06,4.58-.57,49-1.72,79.57Z" style="fill:#263238"></path>
            <path d="M171.85,312.27c.08-.68.16-1.39.24-2.19,1-10.24,2.09-22.53,3-34.37,3.45,9.28,4.94,22.33,6.74,36.56h21c-1.74-36.83-6.3-66.79-8.72-79.57H149.57c-.06,4.58-.57,49-1.72,79.57Z" style="fill:#fff;opacity:0.2;isolation:isolate"></path>
            <path d="M178,141.49a11,11,0,0,1-.36,1.19,11.72,11.72,0,0,1-4.16,5.54,11.3,11.3,0,0,1-1.52.94,10.54,10.54,0,0,1-12.58-2c-4.21-4.25-4.1-9.16-4.58-17.47a11.52,11.52,0,0,1,.85-5.23,11.38,11.38,0,0,1,14.88-6.14C178.65,121.64,179.77,134,178,141.49Z" style="fill:#e4897b"></path>
            <path d="M173.45,148.22a11.3,11.3,0,0,1-1.52.94,10.57,10.57,0,0,1-9.11.4,12.7,12.7,0,0,1,1.49-2.82A16.45,16.45,0,0,1,173.45,148.22Z" style="opacity:0.2;isolation:isolate"></path>
            <path d="M156.72,159c4.1,3.72,14.13,2.35,14.13,2.35s6.26-1.72,4.94-3.67c-3.68-.61-5.47-2.33-6.21-4.54a10.8,10.8,0,0,1-.37-4.21,21,21,0,0,1,.31-2.35l-12.4-9.18C158.74,143.46,160.73,154.61,156.72,159Z" style="fill:#e4897b"></path>
            <path d="M173.45,133.93l1.79.67-.89-3.66s2.62-4,0-7.47c0,0,7.24-2.2,3.15-6-1.52-1.42-3.41,0-8.41-2.17-2.71-1.19-11.19-1.28-11.61,2.17,0,0-6.11,0-6.77,10.4a20.82,20.82,0,0,0,6.47,16.44s7.38,1.74,11-1.22S173.45,133.93,173.45,133.93Z" style="fill:#263238"></path>
            <path d="M168.73,134.52a5.35,5.35,0,0,0,2.76,3.69c1.69.72,2.81-1.66,2.56-4.16-.23-2.22-1.38-5.34-3.19-4.92S168.14,132.28,168.73,134.52Z" style="fill:#e4897b"></path>
            <path d="M175.13,275.66c-.95,11.84-2,24.16-3,34.4-1.52-14.79-3.38-25.33-3.38-25.33s-1.74-1.43-6.53-9.07,0-21.92,0-21.92C162,267,175.13,275.66,175.13,275.66Z" style="opacity:0.2;isolation:isolate"></path>
            <polygon points="204.38 310.54 203.46 314.01 181.1 314.01 181.1 310.8 204.38 310.54" style="fill:#0E386A"></polygon>
            <polygon points="172.93 311.02 172.26 314.23 146.94 314.23 145.41 311.02 172.93 311.02" style="fill:#0E386A"></polygon>
            <path d="M176.05,156.59s-3.64-5.75-12.81-6.16-9.87,5.9-9.87,5.9Z" style="fill:#0E386A"></path>
            <path d="M176.05,156.59s-3.64-5.75-12.81-6.16-9.87,5.9-9.87,5.9Z" style="fill:#fff;opacity:0.5;isolation:isolate"></path>
            <path d="M143.12,153a471.73,471.73,0,0,1-1,93.53l53.73-3.28c-.6-54.83-7.95-89.37-7.95-89.37s-13.85,2.91-25.12,2.49A81.05,81.05,0,0,1,143.12,153Z" style="fill:#0E386A"></path>
            <path d="M187.94,153.92s7.18,16.78,7.95,33.76S166.73,228,166.73,228s-23.07-15.88-40.87-14.44-23.34,7.77-23.34,7.77,13.84-29.61,37.94-39.93c0,0-5-17.05,2.66-28.32C143.12,153,159.78,158.46,187.94,153.92Z" style="fill:#0E386A"></path>
            <path d="M195.89,187.68a13.87,13.87,0,0,1,0,1.44,16.87,16.87,0,0,1-.27,2.21,23.93,23.93,0,0,1-1.53,5h0a55.08,55.08,0,0,1-8.28,13c-1.7,2.08-3.5,4.08-5.28,5.94A140.57,140.57,0,0,1,166.73,228a109.92,109.92,0,0,0-19.23-10.15c-2.05-.82-4.18-1.59-6.35-2.24h0a42.36,42.36,0,0,0-15.28-2,58.45,58.45,0,0,0-14.51,2.84c-.81.28-1.56.58-2.25.87l-.62.27a24.52,24.52,0,0,0-4.28,2.39c-.15.1-.29.21-.42.31s-.47.36-.65.52l-.24.21a1.33,1.33,0,0,0-.17.16l-.12.12-.07.07c0-.05.12-.26.3-.62l.28-.55c.28-.56.67-1.31,1.18-2.22l.22-.4.39-.69c.13-.24.27-.49.42-.74.58-1,1.26-2.16,2-3.39a101.48,101.48,0,0,1,14.5-18.34h0a70.35,70.35,0,0,1,6.24-5.51,55.75,55.75,0,0,1,12.36-7.45A48.25,48.25,0,0,1,138.88,168a34.93,34.93,0,0,1,.35-4.27A25.19,25.19,0,0,1,143.12,153a51.85,51.85,0,0,0,7.5,1.59,97.26,97.26,0,0,0,10,1,126.49,126.49,0,0,0,20.18-.71q3.42-.37,7.11-1l.23.56a118,118,0,0,1,4.11,12.21c.44,1.59.88,3.29,1.3,5.07s.74,3.37,1.06,5.14h0A83.65,83.65,0,0,1,195.89,187.68Z" style="fill:#fff;opacity:0.6000000000000001;isolation:isolate"></path>
            <g style="opacity:0.2;isolation:isolate">
              <path d="M189,201.31l-3.16,8.08c-1.7,2.08-3.5,4.08-5.28,5.94l-6.43-12Z" style="fill:#fff"></path>
              <path d="M134.56,193.59l-12.7.73a70.35,70.35,0,0,1,6.24-5.51Z" style="fill:#fff"></path>
              <path d="M149.21,161.6l-1.36,13.2-9-6.81a34.93,34.93,0,0,1,.35-4.27Z" style="fill:#fff"></path>
              <polygon points="153.37 196.38 149.21 183.7 161.86 181.36 153.37 196.38" style="fill:#fff"></polygon>
              <polygon points="175.13 184.3 175.13 193.79 184.21 190.53 175.13 184.3" style="fill:#fff"></polygon>
              <path d="M151.77,211.79l-4.27,6c-2.05-.82-4.18-1.59-6.35-2.24h0l-3.22-7.34Z" style="fill:#fff"></path>
              <polygon points="119.33 202.69 125.86 205.46 119.33 209.91 119.33 202.69" style="fill:#fff"></polygon>
              <path d="M111.35,216.36c-6.5,2.27-8.83,4.93-8.83,4.93a90.13,90.13,0,0,1,4.83-8.62Z" style="fill:#fff"></path>
              <polygon points="164.71 204.08 159.09 209.91 167.59 211.4 164.71 204.08" style="fill:#fff"></polygon>
              <polygon points="164.71 167.48 171.32 176.38 176.05 166.3 164.71 167.48" style="fill:#fff"></polygon>
              <path d="M194.64,176.9l-8.45-5.56,6.09-4.65C193.14,169.77,194,173.24,194.64,176.9Z" style="fill:#fff"></path>
              <path d="M195.88,189.12a22,22,0,0,1-1.8,7.25l-3.54-8.71Z" style="fill:#fff"></path>
              <path d="M188.17,154.48,182.82,160l-2-5.08q3.42-.37,7.11-1Z" style="fill:#fff"></path>
              <path d="M160.65,155.6l-3.93,8.32-6.1-9.29A97.26,97.26,0,0,0,160.65,155.6Z" style="fill:#fff"></path>
            </g>
            <path d="M195.89,187.68a13.87,13.87,0,0,1,0,1.44,16.87,16.87,0,0,1-.27,2.21c-7-11.1-5.34-21.14-5.34-21.14l3.31,1.57c.38,1.65.74,3.37,1.06,5.14h0A83.65,83.65,0,0,1,195.89,187.68Z" style="opacity:0.2;isolation:isolate"></path>
            <path d="M167.53,109.73c11.87-4.09,14.85,11.72,3.06,22.41s-25.33,12-26.87,6.58S149.41,116,167.53,109.73Z" style="fill:#0E386A"></path>
            <path d="M155.64,108.93c6.09,0,14.74,6.2,14.74,6.2s1.24,6.6-4.83,12.4S154,134.25,150.62,132s-4.32-11-4.32-11a6.7,6.7,0,0,1,4.32-4.45S151.62,109,155.64,108.93Z" style="fill:#0E386A"></path>
            <path d="M165.55,127.53c-6.07,5.8-11.53,6.72-14.93,4.48a5.42,5.42,0,0,1-1.48-1.56c-2.2-3.31-2.84-9.42-2.84-9.42,5.8,7,12.52-.23,13.45-5.11a7.72,7.72,0,0,0-1.55-6.69c4,.86,8.38,3.42,10.64,4.87,1,.61,1.54,1,1.54,1S171.62,121.73,165.55,127.53Z" style="opacity:0.2;isolation:isolate"></path>
            <path d="M165.55,127.53c-6.07,5.8-11.53,6.72-14.93,4.48a5.42,5.42,0,0,1-1.48-1.56c6.08,1.81,13.32-1.2,17.21-6.61a13.4,13.4,0,0,0,2.49-9.74c1,.61,1.54,1,1.54,1S171.62,121.73,165.55,127.53Z" style="fill:#fff;opacity:0.6000000000000001;isolation:isolate"></path>
            <path d="M187.94,153.92s-4.69,9.48,6.7,24.51L219.75,160l-10-18.15Z" style="fill:#0E386A"></path>
            <path d="M219.75,160l-6.55,4.81-9.69,7.13-8.87,6.52c-.58-.76-1.11-1.51-1.61-2.24a43.31,43.31,0,0,1-2.76-4.64A26.92,26.92,0,0,1,187,159.47a13.28,13.28,0,0,1,1-5.55l5.58-3.1,9.61-5.33,4.22-2.35,2.38-1.32Z" style="fill:#fff;opacity:0.6000000000000001;isolation:isolate"></path>
            <g style="opacity:0.2">
              <polygon points="213.2 164.78 203.51 171.91 199.24 162.41 213.2 164.78" style="fill:#fff"></polygon>
              <polygon points="212.3 149.5 203.36 153.04 203.13 145.49 207.35 143.14 212.3 149.5" style="fill:#fff"></polygon>
              <path d="M196.72,156.94,187,159.47a13.28,13.28,0,0,1,1-5.55l5.58-3.1Z" style="fill:#fff"></path>
              <path d="M194.64,169.07,193,176.19a43.31,43.31,0,0,1-2.76-4.64Z" style="fill:#fff"></path>
            </g>
          </g>
        </g>
        <g id="freepik--Suitcase--inject-68">
          <path d="M256.44,324.61,241,323.39l5.1-65.11,15.49,1.21Zm-12.27-4,9.51.74,4.63-59.13-9.5-.74Z" style="fill:#263238"></path>
          <path d="M245.77,408.54l2,.16a4,4,0,1,1-.63,7.94l-2-.16a4,4,0,1,1,.62-7.94Z" style="fill:#263238"></path>
          <path d="M241.42,412.12a4.06,4.06,0,1,0,4.36-3.72A4,4,0,0,0,241.42,412.12Z" style="fill:#fff;opacity:0.1;isolation:isolate"></path>
          <path d="M234.85,407.69l2,.15a4,4,0,1,1-.62,7.94l-2-.15a4,4,0,1,1,.62-7.94Z" style="fill:#263238"></path>
          <path d="M230.5,411.27a4.06,4.06,0,1,0,4.36-3.73A4.07,4.07,0,0,0,230.5,411.27Z" style="fill:#fff;opacity:0.2;isolation:isolate"></path>
          <rect x="234.21" y="309.93" width="20.9" height="99.71" rx="2.69" transform="translate(460.47 737.59) rotate(-175.52)" style="fill:#263238"></rect>
          <rect x="241.94" y="310.24" width="13.16" height="99.71" rx="2.69" transform="translate(468.16 738.49) rotate(-175.52)" style="fill:#fff;opacity:0.2;isolation:isolate"></rect>
          <rect x="245.32" y="257.03" width="17.05" height="5.23" rx="2" transform="matrix(-1, -0.08, 0.08, -1, 486.63, 538.32)" style="fill:#263238"></rect>
          <rect x="245.32" y="257.03" width="17.05" height="5.23" rx="2" transform="matrix(-1, -0.08, 0.08, -1, 486.63, 538.32)" style="fill:#fff;opacity:0.2;isolation:isolate"></rect>
          <rect x="245.33" y="256.57" width="5.09" height="5.23" rx="2" transform="translate(474.79 536.91) rotate(-175.53)" style="opacity:0.2;isolation:isolate"></rect>
          <path d="M287.54,320.64l-6.66,85a5.68,5.68,0,0,1-6.1,5.22l-31-2.43a4,4,0,0,1-3.65-4.29L247,315.77a4,4,0,0,1,4.28-3.66l31,2.43A5.68,5.68,0,0,1,287.54,320.64Z" style="fill:#0E386A"></path>
          <path d="M287.54,320.64l-6.66,85a5.68,5.68,0,0,1-6.1,5.22l-31-2.43a4,4,0,0,1-3.65-4.29L247,315.77a4,4,0,0,1,4.28-3.66l31,2.43A5.68,5.68,0,0,1,287.54,320.64Z" style="fill:#fff;opacity:0.2;isolation:isolate"></path>
          <path d="M266.22,313.28v.12l-1.11-.09a4,4,0,0,0-4.28,3.67l-6.92,88.34a4,4,0,0,0,2.73,4.08l-12.89-1a4,4,0,0,1-3.66-4.28L247,315.78a4,4,0,0,1,4.28-3.67Z" style="opacity:0.2;isolation:isolate"></path>
          <rect x="260.93" y="316.22" width="2.64" height="89.05" rx="1.09" transform="translate(28.98 -19.38) rotate(4.48)" style="opacity:0.2;isolation:isolate"></rect>
          <rect x="267.14" y="317.14" width="2.64" height="89.05" rx="1.09" transform="translate(29.07 -19.87) rotate(4.48)" style="opacity:0.2;isolation:isolate"></rect>
          <rect x="273.34" y="317.51" width="2.64" height="89.05" rx="1.09" transform="translate(29.13 -20.35) rotate(4.48)" style="opacity:0.2;isolation:isolate"></rect>
          <rect x="279.54" y="317.87" width="2.64" height="89.05" rx="1.09" transform="translate(29.17 -20.83) rotate(4.48)" style="opacity:0.2;isolation:isolate"></rect>
        </g>
      </svg>
    </div>



    <!-- Right side for content -->
    <div class="right-content">
      <!-- Welcome Message -->
<div class="welcome-container animate__animated animate__fadeIn">
    <h2 class="welcome-title"><i class="fas fa-user-circle welcome-icon"></i>Welcome, <?php echo htmlspecialchars($user['full_name']); ?></h2>
    <p class="welcome-subtitle">Ready for your next adventure? Book your ticket now!</p>
  </div>


      <!-- Ticket Ordering Section -->
      <section id="ticket-ordering" class="section">
        <h2>Book Your Ticket</h2>
        <p class="section-description">
          Book your trip in 3 easy steps! Select your route, add passengers and baggage, then make payment.
        </p>

        <div class="booking-steps">
          <div class="step active" id="step-1">
            <div class="step-number">1</div>
            <div class="step-label">Route Details</div>
          </div>
          <div class="step" id="step-2">
            <div class="step-number">2</div>
            <div class="step-label">Passengers & Baggage</div>
          </div>
          <div class="step" id="step-3">
            <div class="step-number">3</div>
            <div class="step-label">Payment</div>
          </div>
        </div>

        <form id="ticketForm" method="POST" action="customer-dashboard.php">
          <input type="hidden" name="book_ticket" value="1">

          <!-- Step 1: Route Selection -->
          <div class="form-section active" id="route-section">
            <div class="form-container">
              <div class="form-inputs">
                <div class="form-group">
                  <label for="terminal">Select Terminal:</label>
                  <select id="terminal" name="terminal" required>
                    <option value="">-- Select Terminal --</option>
                    <?php foreach ($terminals as $terminal): ?>
                      <option value="<?php echo $terminal['id']; ?>"><?php echo htmlspecialchars($terminal['name']); ?></option>
                    <?php endforeach; ?>
                  </select>
                </div>
                <div class="form-group">
                  <label for="destination">Select Destination:</label>
                  <select id="destination" name="destination" required>
                    <option value="">-- Select Destination --</option>
                    <?php foreach ($destinations as $destination): ?>
                      <option value="<?php echo $destination['id']; ?>" data-fare="<?php echo $destination['base_fare']; ?>">
                        <?php echo htmlspecialchars($destination['name']); ?> (₱<?php echo $destination['base_fare']; ?>)
                      </option>
                    <?php endforeach; ?>
                  </select>
                </div>












<div class="form-group">
  <label for="bookingDate">Select Date:</label>
  <input type="date" id="date" name="date" required min="<?php echo date('Y-m-d'); ?>">
</div>

<!-- Date Availability Modal -->
<div id="dateAvailabilityModal" class="booking-date-modal" style="display:none;">
  <div class="booking-modal-content">
    <div class="booking-modal-header">
      <i class="fas fa-calendar-times"></i>
      <h3>Date Not Available</h3>
    </div>
    <div class="booking-modal-body">
      <p id="dateModalMessage"></p>
    </div>
    <div class="booking-modal-footer">
      <button id="closeDateModal" class="booking-modal-btn booking-modal-confirm">OK</button>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const bookingDateInput = document.getElementById('date');
  const dateAvailabilityModal = document.getElementById('dateAvailabilityModal');
  const closeDateModalBtn = document.getElementById('closeDateModal');
  const dateModalMessage = document.getElementById('dateModalMessage');

  // Track modal visibility state
  let isDateModalVisible = false;

  date.addEventListener('change', function() {
    const chosenDate = this.value;
    const blockedDates = [
      '2025-06-22', 
      '2024-01-01',  
     
    ];
    
    if (blockedDates.includes(chosenDate)) {
      // Format the date for display (e.g. "June 22, 2025")
      const dateObj = new Date(chosenDate);
      const formattedDate = dateObj.toLocaleDateString('en-US', {
        month: 'long',
        day: 'numeric',
        year: 'numeric'
      });
      
      // Update modal message with formatted date
      dateModalMessage.textContent = `${formattedDate} is not available for booking.`;
      
      displayDateModal();
      this.value = ''; // Clear the selection
    }
  });

  function displayDateModal() {
    dateAvailabilityModal.style.display = 'flex';
    isDateModalVisible = true;
    // Add escape key listener when modal opens
    document.addEventListener('keydown', handleModalEscapeKey);
  }

  function hideDateModal() {
    dateAvailabilityModal.style.display = 'none';
    isDateModalVisible = false;
    // Remove escape key listener when modal closes
    document.removeEventListener('keydown', handleModalEscapeKey);
  }

  function handleModalEscapeKey(event) {
    if (event.key === 'Escape' && isDateModalVisible) {
      hideDateModal();
    }
  }

  // Close modal when clicking OK button
  closeDateModalBtn.addEventListener('click', hideDateModal);

  // Close modal when clicking outside
  dateAvailabilityModal.addEventListener('click', function(event) {
    if (event.target === dateAvailabilityModal) {
      hideDateModal();
    }
  });
});
</script>

<style>
  /* Booking Date Modal Styles */
  .booking-date-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    justify-content: center;
    align-items: center;
  }
  
  .booking-date-modal .booking-modal-content {
    background-color: #fff;
    border-radius: 8px;
    width: 90%;
    max-width: 400px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    overflow: hidden;
    animation: bookingModalAppear 0.3s ease-out;
  }
  
  .booking-date-modal .booking-modal-header {
    padding: 20px;
    background-color: #0E386A;
    color: white;
    display: flex;
    align-items: center;
    gap: 15px;
  }
  
  .booking-date-modal .booking-modal-header i {
    font-size: 24px;
  }
  
  .booking-date-modal .booking-modal-header h3 {
    margin: 0;
    font-size: 18px;
  }
  
  .booking-date-modal .booking-modal-body {
    padding: 25px 20px;
    color: #333;
    font-size: 16px;
    line-height: 1.5;
  }
  
  .booking-date-modal .booking-modal-footer {
    padding: 15px 20px;
    display: flex;
    justify-content: flex-end;
    background-color: #f5f5f5;
  }
  
  .booking-date-modal .booking-modal-btn {
    padding: 8px 20px;
    border-radius: 4px;
    border: none;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
  }
  
  .booking-date-modal .booking-modal-confirm {
    background-color: #0E386A;
    color: white;
  }
  
  .booking-date-modal .booking-modal-confirm:hover {
    background-color: #0a2a52;
  }
  
  @keyframes bookingModalAppear {
    from {
      opacity: 0;
      transform: translateY(-20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>























                <div class="form-group">
                  <label for="time">Select Time:</label>
                  <select id="time" name="time" required>
                    <option value="">-- Select Time --</option>
                    <?php
                    // Generate time slots from 6:00 AM to 6:00 PM every 2 hours
                    for ($hour = 6; $hour <= 18; $hour += 2) {
                      $time_value = sprintf('%02d:00:00', $hour);
                      $time_display = date('g:i A', strtotime($time_value));
                      echo "<option value=\"$time_value\">$time_display</option>";
                    }
                    ?>
                  </select>
                </div>
              </div>
            </div>

            <div class="form-navigation">
              <div></div>
              <button type="button" class="nav-button next" id="next-to-passengers">Next</button>
            </div>
          </div>

          <!-- Step 2: Passengers and Baggage -->
          <div class="form-section" id="passengers-section">
            <div class="form-group">
              <label>Number of Passengers (Max: 12)</label>
              <div class="passenger-controls">
                <button type="button" class="control-button" id="decrease-passengers">-</button>
                <input type="hidden" name="passenger_count" id="passenger_count_input" value="1">
                <span class="control-value" id="passenger-count">1</span>
                <button type="button" class="control-button" id="increase-passengers">+</button>
              </div>
            </div>

            <div class="form-group">
              <label>Baggage (Max: 20kg per passenger)</label>
              <div class="baggage-controls">
                <button type="button" class="control-button" id="decrease-baggage">-</button>
                <input type="hidden" name="baggage_count" id="baggage_count_input" value="0">
                <span class="control-value" id="baggage-count">0</span>
                <button type="button" class="control-button" id="increase-baggage">+</button>
              </div>
              <p class="baggage-info">Each additional kg costs ₱10</p>
            </div>

            <div class="booking-summary">
              <h4>Current Summary</h4>
              <div class="summary-item">
                <span class="summary-label">Base Fare (1 passenger):</span>
                <span class="summary-value" id="base-fare-display">₱0.00</span>
              </div>
              <div class="summary-item">
                <span class="summary-label">Baggage (0kg):</span>
                <span class="summary-value" id="baggage-fee-display">₱0.00</span>
              </div>
              <div class="summary-total">
                <span class="summary-label">Total:</span>
                <span class="summary-value" id="total-fare-display">₱0.00</span>
              </div>
            </div>

            <div class="form-navigation">
              <button type="button" class="nav-button back" id="back-to-route">Back</button>
              <button type="button" class="nav-button next" id="next-to-payment">Next</button>
            </div>
          </div>

          <!-- Step 3: Payment -->
          <div class="form-section" id="payment-section">
            <div class="payment-container">
              <div class="payment-header">
                <h3>Complete Your Payment</h3>
                <p>50% downpayment required to confirm your booking</p>
              </div>

              <div class="payment-options">
                <div class="payment-option selected" data-method="gcash">
                  <div class="payment-icon">
                    <i class="fas fa-mobile-alt"></i>
                  </div>
                  <div class="payment-details">
                    <div class="payment-name">GCash</div>
                    <div class="payment-description">Pay directly via GCash app</div>
                  </div>
                  <input type="radio" name="payment_method" value="gcash" checked style="display: none;">
                </div>
              </div>

              <div class="discount-section">
                <div class="discount-toggle-row">
                  <div class="discount-toggle">
                    <input type="checkbox" id="apply-discount" name="has_discount" class="discount-checkbox">
                    <label for="apply-discount" class="discount-label">
                      Apply Senior/PWD Discount
                    </label>
                  </div>

                  <div class="discount-passenger-selector-row" id="discount-passenger-selector" style="display: none;">
                    <span>Discounted Passengers:</span>
                    <div class="discount-passenger-controls">
                      <button type="button" id="decrease-discounted-passengers">-</button>
                      <input type="hidden" name="discounted_passengers" id="discounted_passengers_input" value="1">
                      <span class="discount-passenger-count" id="discounted-passenger-count">1</span>
                      <button type="button" id="increase-discounted-passengers">+</button>
                    </div>

                    <div class="discount-info-row">
                      <span>Total Discount:</span>
                      <span class="total-discount-amount" id="total-discount-amount">₱30.00</span>
                    </div>
                  </div>
                </div>

                <div class="discount-note">
                  <i class="fas fa-info-circle"></i> Valid ID required for each discounted passenger
                </div>
              </div>

              <div class="payment-summary">
                <h4>Payment Summary</h4>
                <div class="summary-row">
                  <span class="summary-label">Total Fare:</span>
                  <span class="summary-value" id="total-fare">₱0.00</span>
                </div>
                <div class="summary-row">
                  <span class="summary-label">Discount:</span>
                  <span class="summary-value" id="discount-amount">₱0.00</span>
                </div>
                <div class="summary-row summary-total">
                  <span class="summary-label">Downpayment amount to Pay:</span>
                  <span class="summary-value" id="amount-to-pay">₱0.00</span>
                </div>
              </div>

              <button type="submit" class="payment-button" id="proceed-payment">
                <i class="fas fa-lock"></i> Confirm Booking
              </button>
            </div>

            <div class="form-navigation">
              <button type="button" class="nav-button back" id="back-to-passengers">Back</button>
            </div>
          </div>
        </form>
      </section>

    </div>
  </div>



  <!-- Add this before your form -->
  <div id="processingModal" class="processing-modal">
    <div class="processing-content">
      <div class="processing-loader"></div>
      <h3>Processing Payment...</h3>
      <p>Please wait while we process your payment. Do not refresh the page.</p>
    </div>
  </div>

  <!-- Weather and Traffic Section -->
  <section id="weather-traffic" class="section">
    <div class="weather-traffic-wrapper">
      <div class="section-header">
        <h2>Weather and Traffic Updates</h2>
        <div class="current-time">
          <i class="fas fa-clock"></i>
          <span>Current Time in Philippines: <strong id="philippines-time"><?php echo date('h:i A'); ?></strong></span>
        </div>
      </div>

      <div class="weather-traffic-container">
        <!-- Weather Section -->
        <div class="weather-section">
          <h3><i class="fas fa-cloud-sun"></i> Weather Conditions</h3>
          <div class="weather-cards">
            <div class="weather-card manila">
              <div class="video-background">
                <video autoplay loop muted playsinline>
                  <!-- Video sources will be added dynamically -->
                </video>
              </div>
              <div class="location">
                <i class="fas fa-map-marker-alt"></i>
                <h4>Manila</h4>
              </div>
              <div class="weather-icon">
                <i class="fas fa-sun"></i>
              </div>
              <div class="weather-info">
                <div class="temperature">--°C</div>
                <div class="condition">Loading...</div>
                <div class="details">
                  <span><i class="fas fa-tint"></i> <span class="humidity">--%</span></span>
                  <span><i class="fas fa-wind"></i> <span class="wind-speed">-- km/h</span></span>
                </div>
              </div>
            </div>

            <div class="weather-card infanta">
              <div class="video-background">
                <video autoplay loop muted playsinline>
                  <!-- Video sources will be added dynamically -->
                </video>
              </div>
              <div class="location">
                <i class="fas fa-map-marker-alt"></i>
                <h4>Infanta</h4>
              </div>
              <div class="weather-icon">
                <i class="fas fa-cloud-sun"></i>
              </div>
              <div class="weather-info">
                <div class="temperature">--°C</div>
                <div class="condition">Loading...</div>
                <div class="details">
                  <span><i class="fas fa-tint"></i> <span class="humidity">--%</span></span>
                  <span><i class="fas fa-wind"></i> <span class="wind-speed">-- km/h</span></span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Traffic Section -->

        <div class="traffic-section">
          <h3><i class="fas fa-car"></i> Traffic Conditions</h3>
          <div class="traffic-cards">
            <div class="traffic-card" id="manila-infanta">
              <div class="route">
                <i class="fas fa-route"></i>
                <h4>Manila to Infanta</h4>
              </div>
              <div class="traffic-status">
                <div class="status-icon">
                  <i class="fas fa-car-side"></i>
                  <div class="traffic-light"></div>
                </div>
                <div class="status-info">
                  <div class="condition">Loading...</div>
                  <div class="delay">--</div>
                </div>
              </div>
              <div class="travel-time">
                <span><i class="fas fa-hourglass-half"></i> <span class="estimated-time">Est. --h --m</span></span>
              </div>
            </div>

            <div class="traffic-card" id="infanta-manila">
              <div class="route">
                <i class="fas fa-route"></i>
                <h4>Infanta to Manila</h4>
              </div>
              <div class="traffic-status">
                <div class="status-icon">
                  <i class="fas fa-car-side"></i>
                  <div class="traffic-light"></div>
                </div>
                <div class="status-info">
                  <div class="condition">Loading...</div>
                  <div class="delay">--</div>
                </div>
              </div>
              <div class="travel-time">
                <span><i class="fas fa-hourglass-half"></i> <span class="estimated-time">Est. --h --m</span></span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="last-updated">
        <i class="fas fa-clock"></i>
        <span>Last updated: <strong id="update-time"><?php echo date('M j, Y h:i A'); ?></strong></span>
        <button class="refresh-btn"><i class="fas fa-sync-alt"></i> Refresh</button>
      </div>
    </div>
  </section>



  <!-- Chatbot Section -->
  <div class="chatbot">
    <button id="chatbot-toggle" class="chatbot-btn">
      <i class="fas fa-comments"></i>
    </button>
    <div class="chatbot-window">
      <div class="chatbot-header">
        <h3>Vancy</h3>
        <button id="chatbot-close" class="close-btn">&times;</button>
      </div>
      <div class="chatbot-body">
        <div class="chatbot-messages">
          <div class="message bot-message">
            <div class="avatar">
              <img src="img/logo.png" alt="Bot Avatar">
            </div>
            <div class="message-content">
              <p>Hello! 👋 How can I assist you today?</p>
            </div>
          </div>
        </div>
        <div class="chatbot-input-area">
          <input type="text" id="chatbot-input" placeholder="Type your message here..." autocomplete="off">
          <button id="chatbot-send">
            <i class="fas fa-paper-plane"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Ticket History Section -->
<section id="ticket-history" class="section">
  <div class="section-header">
    <h2><i class="fas fa-history"></i> Your Travel History</h2>
    <p class="section-description">
      Review your past and upcoming trips. Scan your barcode at the terminal to complete payment.
    </p>
  </div>
  
  <div class="history-controls">
    <div class="filter-tabs">
      <button class="filter-btn active" data-filter="all">All Tickets</button>
      <button class="filter-btn" data-filter="upcoming">Upcoming</button>
      <button class="filter-btn" data-filter="completed">Completed</button>
      <button class="filter-btn" data-filter="cancelled">Cancelled</button>
    </div>
    <div class="search-box">
      <i class="fas fa-search"></i>
      <input type="text" id="ticket-search" placeholder="Search tickets...">
    </div>
  </div>

  <div class="history-container">
    <?php if (empty($ticket_history)): ?>
      <div class="no-tickets">
        <div class="empty-state">
          <i class="fas fa-ticket-alt"></i>
          <h3>No Tickets Found</h3>
          <p>You haven't booked any tickets yet. Ready for your first adventure?</p>
          <a href="#ticket-ordering" class="btn btn-primary">Book Now</a>
        </div>
      </div>
    <?php else: ?>

      
      <?php foreach ($ticket_history as $ticket): 
    // Get barcode for this ticket
    $barcode_query = "SELECT * FROM ticket_barcodes WHERE ticket_id = {$ticket['id']}";
    $barcode_result = mysqli_query($conn, $barcode_query);
    $barcode = mysqli_fetch_assoc($barcode_result);
?>
        <div class="ticket-card" data-status="<?php echo $ticket['status']; ?>">
          <div class="ticket-header">
            <div class="ticket-meta">
              <span class="ticket-number">#VT<?php echo str_pad($ticket['id'], 4, '0', STR_PAD_LEFT); ?></span>
              <span class="ticket-date">
                <i class="far fa-calendar-alt"></i> 
                <?php echo date('F j, Y', strtotime($ticket['travel_date'])); ?>
                <i class="far fa-clock"></i> 
                <?php echo date('g:i A', strtotime($ticket['travel_time'])); ?>
              </span>
            </div>
            <div class="ticket-status <?php echo $ticket['status']; ?>">
              <?php 
              echo ucfirst($ticket['status']);
              if ($ticket['fully_paid']) {
                echo ' • Paid';
              }
              ?>
            </div>
          </div>

          <div class="ticket-body">
            <div class="route-info">
              <div class="route">
                <div class="terminal">
                  <span class="label">From</span>
                  <h4><?php echo htmlspecialchars($ticket['terminal_name']); ?></h4>
                </div>
                <div class="divider">
                  <i class="fas fa-arrow-right"></i>
                </div>
                <div class="destination">
                  <span class="label">To</span>
                  <h4><?php echo htmlspecialchars($ticket['destination_name']); ?></h4>
                </div>
              </div>
            </div>

<div class="ticket-details">
    <div class="detail-group">
        <div class="detail">
            <span class="label"><i class="fas fa-users"></i> Passengers</span>
            <span class="value"><?php echo $ticket['passenger_count']; ?></span>
        </div>
        <div class="detail">
            <span class="label"><i class="fas fa-suitcase"></i> Baggage</span>
            <span class="value"><?php echo $ticket['baggage_count']; ?> kg</span>
        </div>
        <div class="detail">
            <span class="label"><i class="fas fa-money-bill-wave"></i> Amount</span>
            <span class="value">₱<?php echo number_format($ticket['total_amount'], 2); ?></span>
        </div>
    </div>

<?php if ($barcode): ?>
<div class="barcode-section">
    <div class="barcode-container">
        <div class="barcode-header">
            <span>Ticket Barcode</span>
            <?php if ($barcode['scan_status'] == 'scanned'): ?>
                <span class="scan-status scanned">
                    <i class="fas fa-check-circle"></i> Scanned at <?php echo date('M j, g:i A', strtotime($barcode['scan_time'])); ?>
                </span>
            <?php else: ?>
                <span class="scan-status unscanned">
                    <i class="fas fa-hourglass-half"></i> Not yet scanned
                </span>
            <?php endif; ?>
        </div>
        
        <div class="barcode-image-container">
            <?php
            try {
                // Debug output
                echo "<!-- Barcode debug info:\n";
                echo "Barcode value: " . htmlspecialchars($barcode['barcode_value']) . "\n";
                echo "GD installed: " . (extension_loaded('gd') ? 'Yes' : 'No') . "\n";
                echo "Picqer loaded: " . (class_exists('Picqer\Barcode\BarcodeGeneratorPNG') ? 'Yes' : 'No') . "\n";
                echo "-->\n";
                
                $generator = new Picqer\Barcode\BarcodeGeneratorPNG();
                $barcodeImage = $generator->getBarcode(
                    $barcode['barcode_value'], 
                    $generator::TYPE_CODE_128,
                    2, // Width
                    50, // Height
                    [0, 0, 0] // Black color
                );
                
                if ($barcodeImage === false) {
                    throw new Exception('Barcode generation returned false');
                }
                
                $barcodeDataUri = 'data:image/png;base64,' . base64_encode($barcodeImage);
                ?>
                <img src="<?= $barcodeDataUri ?>" alt="Ticket Barcode" class="barcode-img">
                <div class="barcode-number"><?= htmlspecialchars($barcode['barcode_value']) ?></div>
                <?php
            } catch (Exception $e) {
                error_log("Barcode generation error: " . $e->getMessage());
                ?>
                <div class="barcode-error">
                    <i class="fas fa-exclamation-triangle"></i>
                    <p>Barcode could not be generated</p>
                    <p>Error: <?= htmlspecialchars($e->getMessage()) ?></p>
                    <p>Ticket ID: <?= htmlspecialchars($barcode['barcode_value']) ?></p>
                </div>
                <?php
            }
            ?>
        </div>
    </div>
</div>
<?php endif; ?>


<style>
  /* Base styles for all screens */
  .barcode-section {
    margin: 15px 0;
  }
  
  .barcode-container {
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 15px;
    background: white;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  }
  
  .barcode-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
    flex-wrap: wrap;
  }
  
  .barcode-header span:first-child {
    font-weight: bold;
    color: #0E386A;
  }
  
  .scan-status {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 14px;
  }
  
  .scan-status.scanned {
    background-color: #e6f7ee;
    color: #28a745;
  }
  
  .scan-status.unscanned {
    background-color: #fff3cd;
    color: #856404;
  }
  
  .barcode-image-container {
    text-align: center;
    margin: 15px 0;
  }
  
  .barcode-img {
    max-width: 100%;
    height: auto;
    display: block;
    margin: 0 auto;
  }
  
  .barcode-number {
    margin-top: 8px;
    font-family: monospace;
    font-size: 16px;
    word-break: break-all;
    text-align: center;
  }
  
  .barcode-error {
    padding: 15px;
    background-color: #fff8f8;
    border: 1px solid #ffdddd;
    border-radius: 4px;
    color: #d9534f;
    text-align: center;
  }
  
  .barcode-error i {
    font-size: 24px;
    margin-bottom: 10px;
  }
  
  .barcode-error p {
    margin: 5px 0;
  }

  /* Mobile-specific styles (≤ 575px) */
  @media (max-width: 575px) {
    .barcode-container {
      padding: 10px;
      border-radius: 6px;
    }
    
    .barcode-header {
      flex-direction: column;
      align-items: flex-start;
      gap: 8px;
    }
    
    .scan-status {
      font-size: 12px;
      padding: 3px 6px;
    }
    
    .barcode-img {
      /* Reduce height on mobile */
      height: 40px;
      width: auto;
    }
    
    .barcode-number {
      font-size: 14px;
    }
    
    .barcode-error {
      padding: 10px;
    }
    
    .barcode-error i {
      font-size: 20px;
    }
    
    .barcode-error p {
      font-size: 14px;
    }
  }
</style>
</div>
          </div>

          

          <?php if ($ticket['status'] === 'completed'): ?>
            <div class="ticket-footer">
              <?php if ($ticket['stars']): ?>
                <div class="rating-display">
                  <div class="stars">
                    <?php for ($i = 1; $i <= 5; $i++): ?>
                      <i class="fas fa-star<?php echo $i > $ticket['stars'] ? '-half-alt' : ''; ?>"></i>
                    <?php endfor; ?>
                  </div>
                  <?php if (!empty($ticket['comment'])): ?>
                    <div class="rating-comment">
                      <i class="fas fa-quote-left"></i>
                      <p><?php echo htmlspecialchars($ticket['comment']); ?></p>
                    </div>
                  <?php endif; ?>
                  <span class="rating-notice">
                    <i class="fas fa-check"></i> Rating submitted
                  </span>
                </div>
              <?php else: ?>
                <div class="rating-form">
                  <h4>Rate your experience</h4>
                  <form method="POST" action="customer-dashboard.php">
                    <input type="hidden" name="submit_rating" value="1">
                    <input type="hidden" name="ticket_id" value="<?php echo $ticket['id']; ?>">
                    <div class="star-rating">
                      <?php for ($i = 1; $i <= 5; $i++): ?>
                        <i class="far fa-star" data-rating="<?php echo $i; ?>"></i>
                      <?php endfor; ?>
                      <input type="hidden" name="stars" id="stars-input-<?php echo $ticket['id']; ?>" value="">
                      <span class="rating-text">Tap to rate</span>
                    </div>
                    <div class="form-group">
                      <textarea name="comment" placeholder="How was your trip? (Optional)" class="rating-comment-input"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary btn-sm">Submit Rating</button>
                  </form>
                </div>
              <?php endif; ?>
            </div>
          <?php endif; ?>
        </div>
      <?php endforeach; ?>
    <?php endif; ?>
  </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Filter tickets
  const filterButtons = document.querySelectorAll('.filter-btn');
  const ticketCards = document.querySelectorAll('.ticket-card');
  
  filterButtons.forEach(button => {
    button.addEventListener('click', function() {
      const filter = this.dataset.filter;
      
      // Update active button
      filterButtons.forEach(btn => btn.classList.remove('active'));
      this.classList.add('active');
      
      // Filter tickets
      ticketCards.forEach(card => {
        if (filter === 'all' || card.dataset.status === filter) {
          card.style.display = 'block';
        } else {
          card.style.display = 'none';
        }
      });
    });
  });
  
  // Search functionality
  const searchInput = document.getElementById('ticket-search');
  searchInput.addEventListener('input', function() {
    const searchTerm = this.value.toLowerCase();
    
    ticketCards.forEach(card => {
      const cardText = card.textContent.toLowerCase();
      if (cardText.includes(searchTerm)) {
        card.style.display = 'block';
      } else {
        card.style.display = 'none';
      }
    });
  });
  
  // Star rating functionality
  document.querySelectorAll('.star-rating i').forEach(star => {
    star.addEventListener('click', function() {
      const rating = parseInt(this.getAttribute('data-rating'));
      const container = this.closest('.star-rating');
      const stars = container.querySelectorAll('i');
      const text = container.querySelector('.rating-text');
      const input = container.querySelector('input[type="hidden"]');
      
      stars.forEach((s, index) => {
        s.classList.toggle('fas', index < rating);
        s.classList.toggle('far', index >= rating);
      });
      
      text.textContent = rating + (rating === 1 ? ' star' : ' stars');
      input.value = rating;
    });
  });
});
</script>

  <div id="alertModal" class="alert-modal">
    <div class="alert-modal-content">
      <div class="alert-modal-icon">
        <i class="fas fa-exclamation-circle"></i>
      </div>
      <div class="alert-modal-body">
        <h3 class="alert-modal-title">Alert</h3>
        <p class="alert-modal-message" id="alertModalMessage"></p>
      </div>
      <div class="alert-modal-footer">
        <button class="alert-modal-button" id="alertModalButton">OK</button>
      </div>
    </div>
  </div>


  <script src="menuxxx.js"></script>
  <script src="chatbot.js"></script>
  <script src="weather.js"></script>
  <script src="scrollAnimate.js"></script>


  <script>

// Video files for different weather conditions
const weatherVideos = {
  sunny: 'weather/sunny-bg.mp4',
  'partly-cloudy': 'weather/partly-cloudy-bg.mp4',
  'partly-cloudy-night': 'weather/partly-cloudy-night-bg.mp4',
  rainy: 'weather/rainy-bg.mp4',
  'clear-night': 'weather/clear-night-bg.mp4'
};

// Weather Update Function
function updateWeather() {
  const hour = new Date().getHours();
  const manilaCard = document.querySelector('.weather-card.manila');
  const infantaCard = document.querySelector('.weather-card.infanta');

  if (!manilaCard || !infantaCard) return;

  // Determine time of day
  let timeOfDay;
  if (hour >= 6 && hour < 12) {
    timeOfDay = 'morning';
  } else if (hour >= 12 && hour < 18) {
    timeOfDay = 'afternoon';
  } else if (hour >= 18 && hour < 24) {
    timeOfDay = 'evening';
  } else {
    timeOfDay = 'night';
  }
  

  // Weather data for different times of day
  const weatherData = {
    morning: { // 6am-11:59am
      manila: {
        icon: 'fa-sun',
        iconClass: 'sunny',
        temp: 34,
        condition: 'Sunny',
        humidity: 55,
        wind: 10
      },
      infanta: {
        icon: 'fa-cloud-sun',
        iconClass: 'partly-cloudy',
        temp: 30,
        condition: 'Partly Cloudy',
        humidity: 70,
        wind: 7
      }
    },
    afternoon: { // 12pm-5:59pm
      manila: {
        icon: 'fa-cloud-sun',
        iconClass: 'partly-cloudy',
        temp: 36,
        condition: 'Partly Cloudy',
        humidity: 60,
        wind: 12
      },
      infanta: {
        icon: 'fa-cloud-rain',
        iconClass: 'rainy',
        temp: 32,
        condition: 'Scattered Showers',
        humidity: 80,
        wind: 9
      }
    },
    evening: { // 6pm-11:59pm
      manila: {
        icon: 'fa-cloud-moon',
        iconClass: 'partly-cloudy-night',
        temp: 30,
        condition: 'Partly Cloudy',
        humidity: 70,
        wind: 8
      },
      infanta: {
        icon: 'fa-cloud-moon',
        iconClass: 'partly-cloudy-night',
        temp: 27,
        condition: 'Partly Cloudy',
        humidity: 85,
        wind: 6
      }
    },
    night: { // 12am-5:59am
      manila: {
        icon: 'fa-moon',
        iconClass: 'clear-night',
        temp: 28,
        condition: 'Clear',
        humidity: 75,
        wind: 7
      },
      infanta: {
        icon: 'fa-moon',
        iconClass: 'clear-night',
        temp: 25,
        condition: 'Clear',
        humidity: 90,
        wind: 5
      }
    }
  };

  const manilaWeather = weatherData[timeOfDay].manila;
  const infantaWeather = weatherData[timeOfDay].infanta;

  // Update video backgrounds
  updateVideoBackground(manilaCard, manilaWeather.iconClass);
  updateVideoBackground(infantaCard, infantaWeather.iconClass);

  // Update Manila weather
  updateWeatherCard(manilaCard, manilaWeather);
  
  // Update Infanta weather
  updateWeatherCard(infantaCard, infantaWeather);
}

function updateVideoBackground(card, weatherType) {
  const videoContainer = card.querySelector('.video-background');
  const videoElement = videoContainer.querySelector('video');
  
  // Only update if the weather type has changed
  if (videoElement.dataset.currentWeather !== weatherType) {
    // Remove any existing source elements
    while (videoElement.firstChild) {
      videoElement.removeChild(videoElement.firstChild);
    }
    
    // Create new source element
    const source = document.createElement('source');
    source.src = weatherVideos[weatherType];
    source.type = 'video/mp4';
    
    videoElement.appendChild(source);
    videoElement.dataset.currentWeather = weatherType;
    videoElement.load();
    
    // Attempt to play (muted videos should autoplay)
    const playPromise = videoElement.play();
    
    if (playPromise !== undefined) {
      playPromise.catch(error => {
        console.log("Video autoplay prevented, trying muted:", error);
        videoElement.muted = true;
        videoElement.play();
      });
    }
  }
}

function updateWeatherCard(card, weather) {
  const icon = card.querySelector('.weather-icon i');
  const temp = card.querySelector('.temperature');
  const condition = card.querySelector('.condition');
  const humidity = card.querySelector('.humidity');
  const wind = card.querySelector('.wind-speed');
  const weatherIcon = card.querySelector('.weather-icon');

  // Update all elements
  icon.className = `fas ${weather.icon}`;
  weatherIcon.className = `weather-icon ${weather.iconClass}`;
  temp.textContent = `${weather.temp}°C`;
  condition.textContent = weather.condition;
  humidity.textContent = `${weather.humidity}%`;
  wind.textContent = `${weather.wind} km/h`;
}

// Initialize weather immediately
document.addEventListener('DOMContentLoaded', function() {
  updateWeather();
  
  // Update weather every 30 minutes
  setInterval(updateWeather, 30 * 60 * 1000);
  
  // Add click handler for refresh button
  const refreshBtn = document.querySelector('.refresh-btn');
  if (refreshBtn) {
    refreshBtn.addEventListener('click', function() {
      // Show loading state
      this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Refreshing';
      
      updateWeather();
      
      // Reset button after 1 second
      setTimeout(() => {
        this.innerHTML = '<i class="fas fa-sync-alt"></i> Refresh';
        updateLastUpdatedTime();
      }, 1000);
    });
  }
});

function updateLastUpdatedTime() {
  const now = new Date();
  const options = { 
    month: 'short', 
    day: 'numeric', 
    year: 'numeric', 
    hour: '2-digit', 
    minute: '2-digit' 
  };
  document.getElementById('update-time').textContent = now.toLocaleDateString('en-US', options);
}

    // Enhanced Traffic Update Function
    function updateTraffic() {
      const hour = new Date().getHours();
      const manilaToInfantaCard = document.getElementById('manila-infanta');
      const infantaToManilaCard = document.getElementById('infanta-manila');

      if (!manilaToInfantaCard || !infantaToManilaCard) return;

      // Traffic data for different times of day
      const trafficData = {
        morningRush: { // 7am-9am
          manilaToInfanta: {
            condition: 'Heavy Traffic',
            delay: '+30 min delay',
            color: '#e74c3c',
            class: 'heavy',
            time: '3h 45m'
          },
          infantaToManila: {
            condition: 'Moderate Traffic',
            delay: '+20 min delay',
            color: '#f39c12',
            class: 'moderate',
            time: '3h 30m'
          }
        },
        lateMorning: { // 9am-12pm
          manilaToInfanta: {
            condition: 'Moderate Traffic',
            delay: '+15 min delay',
            color: '#f39c12',
            class: 'moderate',
            time: '3h 30m'
          },
          infantaToManila: {
            condition: 'Light Traffic',
            delay: '+10 min delay',
            color: '#2ecc71',
            class: 'light',
            time: '3h 15m'
          }
        },
        lunchTime: { // 12pm-2pm
          manilaToInfanta: {
            condition: 'Light Traffic',
            delay: '+5 min delay',
            color: '#2ecc71',
            class: 'light',
            time: '3h 15m'
          },
          infantaToManila: {
            condition: 'Moderate Traffic',
            delay: '+15 min delay',
            color: '#f39c12',
            class: 'moderate',
            time: '3h 30m'
          }
        },
        afternoon: { // 2pm-5pm
          manilaToInfanta: {
            condition: 'Moderate Traffic',
            delay: '+20 min delay',
            color: '#f39c12',
            class: 'moderate',
            time: '3h 30m'
          },
          infantaToManila: {
            condition: 'Heavy Traffic',
            delay: '+30 min delay',
            color: '#e74c3c',
            class: 'heavy',
            time: '3h 45m'
          }
        },
        eveningRush: { // 5pm-8pm
          manilaToInfanta: {
            condition: 'Heavy Traffic',
            delay: '+40 min delay',
            color: '#e74c3c',
            class: 'heavy',
            time: '4h 00m'
          },
          infantaToManila: {
            condition: 'Heavy Traffic',
            delay: '+40 min delay',
            color: '#e74c3c',
            class: 'heavy',
            time: '4h 00m'
          }
        },
        night: { // 8pm-7am
          manilaToInfanta: {
            condition: 'Light Traffic',
            delay: 'No delays',
            color: '#2ecc71',
            class: 'light',
            time: '3h 15m'
          },
          infantaToManila: {
            condition: 'Light Traffic',
            delay: 'No delays',
            color: '#2ecc71',
            class: 'light',
            time: '3h 15m'
          }
        }
      };

      // Determine current time period
      let timePeriod;
      if (hour >= 7 && hour < 9) timePeriod = 'morningRush';
      else if (hour >= 9 && hour < 12) timePeriod = 'lateMorning';
      else if (hour >= 12 && hour < 14) timePeriod = 'lunchTime';
      else if (hour >= 14 && hour < 17) timePeriod = 'afternoon';
      else if (hour >= 17 && hour < 20) timePeriod = 'eveningRush';
      else timePeriod = 'night';

      const currentTraffic = trafficData[timePeriod];

      // Update Manila to Infanta route
      const manilaCondition = manilaToInfantaCard.querySelector('.condition');
      const manilaDelay = manilaToInfantaCard.querySelector('.delay');
      const manilaLight = manilaToInfantaCard.querySelector('.traffic-light');
      const manilaTime = manilaToInfantaCard.querySelector('.estimated-time');

      manilaToInfantaCard.className = `traffic-card ${currentTraffic.manilaToInfanta.class}`;
      manilaCondition.textContent = currentTraffic.manilaToInfanta.condition;
      manilaDelay.textContent = currentTraffic.manilaToInfanta.delay;
      manilaLight.style.backgroundColor = currentTraffic.manilaToInfanta.color;
      manilaTime.textContent = `Est. ${currentTraffic.manilaToInfanta.time}`;

      // Update Infanta to Manila route
      const infantaCondition = infantaToManilaCard.querySelector('.condition');
      const infantaDelay = infantaToManilaCard.querySelector('.delay');
      const infantaLight = infantaToManilaCard.querySelector('.traffic-light');
      const infantaTime = infantaToManilaCard.querySelector('.estimated-time');

      infantaToManilaCard.className = `traffic-card ${currentTraffic.infantaToManila.class}`;
      infantaCondition.textContent = currentTraffic.infantaToManila.condition;
      infantaDelay.textContent = currentTraffic.infantaToManila.delay;
      infantaLight.style.backgroundColor = currentTraffic.infantaToManila.color;
      infantaTime.textContent = `Est. ${currentTraffic.infantaToManila.time}`;
    }

    // Initialize traffic immediately
    updateTraffic();



    //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////





    document.addEventListener('DOMContentLoaded', function() {
      const paymentButton = document.getElementById('proceed-payment');
      const processingModal = document.getElementById('processingModal');

      if (paymentButton) {
        paymentButton.addEventListener('click', function(e) {
          // Prevent immediate form submission
          e.preventDefault();

          // Show processing modal
          processingModal.style.display = 'flex';

          // Optional: Add a small delay to let the modal display properly
          setTimeout(() => {
            // Find the closest form and submit it
            const form = this.closest('form');
            if (form) {
              form.submit();
            }
          }, 500);
        });
      }
    });




    document.addEventListener('DOMContentLoaded', function() {
      const logoutTrigger = document.getElementById('logout-trigger');
      const logoutDialog = document.getElementById('logout-dialog');
      const logoutCancel = document.getElementById('logout-cancel');
      const logoutConfirm = document.getElementById('logout-confirm');

      if (logoutTrigger) {
        logoutTrigger.addEventListener('click', function(e) {
          e.preventDefault();
          logoutDialog.classList.add('active');
        });
      }

      if (logoutCancel) {
        logoutCancel.addEventListener('click', function() {
          logoutDialog.classList.remove('active');
        });
      }

      if (logoutConfirm) {
        logoutConfirm.addEventListener('click', function() {
          window.location.href = 'index.php';
        });
      }

      // Close when clicking outside dialog
      logoutDialog.addEventListener('click', function(e) {
        if (e.target === logoutDialog) {
          logoutDialog.classList.remove('active');
        }
      });

      // Close with Escape key
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && logoutDialog.classList.contains('active')) {
          logoutDialog.classList.remove('active');
        }
      });
    });
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const modalOverlay = document.getElementById('messageModal');
      const modalContent = document.querySelector('.modal-content');
      const loadingState = document.getElementById('loadingState');
      const messageState = document.getElementById('messageState');
      const modalTitle = document.getElementById('modalTitle');
      const modalMessage = document.getElementById('modalMessage');
      const modalButton = document.getElementById('modalButton');

      <?php if (isset($_SESSION['success_message'])): ?>
        showPopup('success', '<?php echo addslashes($_SESSION['success_message']); ?>', true);
        <?php unset($_SESSION['success_message']); ?>
      <?php endif; ?>

      <?php if (isset($_SESSION['error_message'])): ?>
        showPopup('error', '<?php echo addslashes($_SESSION['error_message']); ?>', true);
        <?php unset($_SESSION['error_message']); ?>
      <?php endif; ?>

      function showPopup(type, message, showLoading) {
        // Reset modal classes
        modalContent.className = 'modal-content ' + type;

        if (showLoading) {
          // Show loading state first
          loadingState.style.display = 'block';
          messageState.style.display = 'none';
          modalOverlay.classList.add('active');

          // After 3 seconds, show the message
          setTimeout(function() {
            loadingState.style.display = 'none';
            messageState.style.display = 'block';

            modalTitle.textContent = type === 'success' ? 'Success!' : 'Error!';
            modalMessage.textContent = message;

            const icon = document.querySelector('.modal-icon i');
            if (type === 'success') {
              icon.className = 'fas fa-check-circle';
              modalButton.className = 'modal-button';
            } else {
              icon.className = 'fas fa-exclamation-circle';
              modalButton.className = 'modal-button error';
            }
          }, 3000);
        } else {
          // Show message immediately without loading
          loadingState.style.display = 'none';
          messageState.style.display = 'block';
          modalTitle.textContent = type === 'success' ? 'Success!' : 'Error!';
          modalMessage.textContent = message;
          modalOverlay.classList.add('active');

          const icon = document.querySelector('.modal-icon i');
          if (type === 'success') {
            icon.className = 'fas fa-check-circle';
            modalButton.className = 'modal-button';
          } else {
            icon.className = 'fas fa-exclamation-circle';
            modalButton.className = 'modal-button error';
          }
        }
      }

      modalButton.addEventListener('click', function() {
        modalOverlay.classList.remove('active');
      });

      // Close modal when clicking outside
      modalOverlay.addEventListener('click', function(e) {
        if (e.target === modalOverlay) {
          modalOverlay.classList.remove('active');
        }
      });
    });

    document.addEventListener('DOMContentLoaded', function() {
      const modalOverlay = document.getElementById('messageModal');
      const loadingState = document.getElementById('loadingState');
      const messageState = document.getElementById('messageState');
      const modalTitle = document.getElementById('modalTitle');
      const modalMessage = document.getElementById('modalMessage');
      const modalButton = document.getElementById('modalButton');
      const modalContent = document.querySelector('.modal-content');

      <?php if (isset($_SESSION['success_message'])): ?>
        showPopup('success', '<?php echo addslashes($_SESSION['success_message']); ?>');
        <?php unset($_SESSION['success_message']); ?>
      <?php endif; ?>

      <?php if (isset($_SESSION['error_message'])): ?>
        showPopup('error', '<?php echo addslashes($_SESSION['error_message']); ?>');
        <?php unset($_SESSION['error_message']); ?>
      <?php endif; ?>

      function showPopup(type, message) {
        // Show loading state first
        loadingState.style.display = 'block';
        messageState.style.display = 'none';
        modalContent.className = 'modal-content ' + type;
        modalOverlay.classList.add('active');

        // After 3 seconds, show the message
        setTimeout(function() {
          loadingState.style.display = 'none';
          messageState.style.display = 'block';

          modalTitle.textContent = type === 'success' ? 'Success!' : 'Error!';
          modalMessage.textContent = message;

          const icon = document.querySelector('.modal-icon i');
          if (type === 'success') {
            icon.className = 'fas fa-check-circle';
            modalButton.className = 'modal-button';
          } else {
            icon.className = 'fas fa-exclamation-circle';
            modalButton.className = 'modal-button error';
          }
        }, 3000);
      }

      modalButton.addEventListener('click', function() {
        modalOverlay.classList.remove('active');
      });

      // Close when clicking outside
      modalOverlay.addEventListener('click', function(e) {
        if (e.target === modalOverlay) {
          modalOverlay.classList.remove('active');
        }
      });
    });

    //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



    document.addEventListener('DOMContentLoaded', function() {
      const paymentButton = document.getElementById('proceed-payment');
      const processingModal = document.getElementById('processingModal');

      if (paymentButton) {
        paymentButton.addEventListener('click', function(e) {
          // Prevent immediate form submission
          e.preventDefault();

          // Show processing modal
          processingModal.style.display = 'flex';

          // Optional: Add a small delay to let the modal display properly
          setTimeout(() => {
            // Find the closest form and submit it
            const form = this.closest('form');
            if (form) {
              form.submit();
            }
          }, 500);
        });
      }
    });


    //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



    document.addEventListener('DOMContentLoaded', function() {
      // Pricing Constants
      const SERVICE_FEE = 0;
      const BAGGAGE_FEE_PER_KG = 10;
      const DISCOUNT_PER_PASSENGER = 30;

      // Passenger and Discount Counters
      let passengerCount = 1;
      let discountedPassengerCount = 1;
      let baggageCount = 0;
      const maxPassengers = 12;
      const maxBaggagePerPassenger = 20;

      // DOM Elements
      const discountCheckbox = document.getElementById('apply-discount');
      const discountPassengerSelector = document.getElementById('discount-passenger-selector');

      // Initialize form
      initEventListeners();
      updateBaseFare();

      function initEventListeners() {
        // Step Navigation
        document.getElementById('next-to-passengers').addEventListener('click', nextToPassengers);
        document.getElementById('back-to-route').addEventListener('click', () => updateStep(1));
        document.getElementById('next-to-payment').addEventListener('click', nextToPayment);
        document.getElementById('back-to-passengers').addEventListener('click', () => updateStep(2));

        // Passenger Controls
        document.getElementById('increase-passengers').addEventListener('click', increasePassengers);
        document.getElementById('decrease-passengers').addEventListener('click', decreasePassengers);

        // Baggage Controls
        document.getElementById('increase-baggage').addEventListener('click', increaseBaggage);
        document.getElementById('decrease-baggage').addEventListener('click', decreaseBaggage);

        // Discount Controls
        discountCheckbox.addEventListener('change', handleDiscountToggle);
        document.getElementById('increase-discounted-passengers').addEventListener('click', increaseDiscountedPassengers);
        document.getElementById('decrease-discounted-passengers').addEventListener('click', decreaseDiscountedPassengers);

        // Destination change
        document.getElementById('destination').addEventListener('change', updateBaseFare);

        // Star ratings
        document.querySelectorAll('.star-rating i').forEach(star => {
          star.addEventListener('click', function() {
            const rating = parseInt(this.getAttribute('data-rating'));
            const container = this.closest('.star-rating');
            const stars = container.querySelectorAll('i');
            const text = container.querySelector('.rating-text');
            const input = container.querySelector('input[type="hidden"]');

            stars.forEach((s, index) => {
              s.classList.toggle('fas', index < rating);
              s.classList.toggle('far', index >= rating);
            });

            text.textContent = rating + (rating === 1 ? ' star' : ' stars');
            input.value = rating;
          });
        });
      }

      function updateBaseFare() {
        const destinationSelect = document.getElementById('destination');
        const selectedOption = destinationSelect.options[destinationSelect.selectedIndex];
        const baseFare = parseFloat(selectedOption.getAttribute('data-fare')) || 0;

        document.getElementById('base-fare-display').textContent = `₱${baseFare.toFixed(2)}`;
        updateSummary();
      }

      // Passenger Functions
      function increasePassengers() {
        if (passengerCount < maxPassengers) {
          passengerCount++;
          updatePassengerDisplay();
          updateDiscountControls();
        } else {
          showAlert(`Maximum ${maxPassengers} passengers allowed per booking`);
        }
      }

      function decreasePassengers() {
        if (passengerCount > 1) {
          passengerCount--;
          updatePassengerDisplay();
          updateDiscountControls();
        }
      }

      function updatePassengerDisplay() {
        document.getElementById('passenger-count').textContent = passengerCount;
        document.getElementById('passenger_count_input').value = passengerCount;

        // Adjust baggage limit if needed
        const maxBaggage = maxBaggagePerPassenger * passengerCount;
        if (baggageCount > maxBaggage) {
          baggageCount = maxBaggage;
          document.getElementById('baggage-count').textContent = baggageCount;
          document.getElementById('baggage_count_input').value = baggageCount;
        }

        updateSummary();
      }

      // Baggage Functions
      function increaseBaggage() {
        const maxAllowed = maxBaggagePerPassenger * passengerCount;
        if (baggageCount < maxAllowed) {
          baggageCount++;
          document.getElementById('baggage-count').textContent = baggageCount;
          document.getElementById('baggage_count_input').value = baggageCount;
          updateSummary();
        } else {
          showAlert(`Maximum ${maxAllowed}kg baggage allowed for ${passengerCount} passenger(s)`);
        }
      }

      function decreaseBaggage() {
        if (baggageCount > 0) {
          baggageCount--;
          document.getElementById('baggage-count').textContent = baggageCount;
          document.getElementById('baggage_count_input').value = baggageCount;
          updateSummary();
        }
      }

      // Discount Functions
      function handleDiscountToggle() {
        if (this.checked && passengerCount < 1) {
          showAlert('Discount requires at least 2 passengers');
          this.checked = false;
          return;
        }

        updateDiscountControls();
        updateSummary();
      }

      function increaseDiscountedPassengers() {
        if (discountedPassengerCount < passengerCount) {
          discountedPassengerCount++;
          updateDiscountControls();
        }
      }

      function decreaseDiscountedPassengers() {
        if (discountedPassengerCount > 1) {
          discountedPassengerCount--;
          updateDiscountControls();
        }
      }

      function updateDiscountControls() {
        const countDisplay = document.getElementById('discounted-passenger-count');
        const totalDisplay = document.getElementById('total-discount-amount');
        const increaseBtn = document.getElementById('increase-discounted-passengers');
        const decreaseBtn = document.getElementById('decrease-discounted-passengers');

        countDisplay.textContent = discountedPassengerCount;
        document.getElementById('discounted_passengers_input').value = discountedPassengerCount;
        totalDisplay.textContent = `₱${(DISCOUNT_PER_PASSENGER * discountedPassengerCount).toFixed(2)}`;

        // Toggle selector visibility
        const shouldShow = discountCheckbox.checked && passengerCount >= 2;
        discountPassengerSelector.style.display = shouldShow ? 'flex' : 'none';

        // Update button states
        if (shouldShow) {
          increaseBtn.disabled = discountedPassengerCount >= passengerCount;
          decreaseBtn.disabled = discountedPassengerCount <= 1;
        }

        updateSummary();
      }

      // Navigation Functions
      function nextToPassengers() {
        if (validateRouteSection()) {
          updateStep(2);
          updateSummary();
        }
      }

      function nextToPayment() {
        if (validatePassengerSection()) {
          updateStep(3);
          updateSummary();
        }
      }

      function updateStep(stepNumber) {
        document.querySelectorAll('.step').forEach((step, index) => {
          step.classList.toggle('completed', index < stepNumber - 1);
          step.classList.toggle('active', index === stepNumber - 1);
        });

        document.querySelectorAll('.form-section').forEach((section, index) => {
          if (index === stepNumber - 1) {
            section.classList.add('active');
            setTimeout(() => section.scrollIntoView({
              behavior: 'smooth',
              block: 'start'
            }), 100);
          } else {
            section.classList.remove('active');
          }
        });
      }

      function showAlert(message) {
        const alertModal = document.getElementById('alertModal');
        const alertMessage = document.getElementById('alertModalMessage');
        const alertButton = document.getElementById('alertModalButton');

        // Set the message
        alertMessage.textContent = message;

        // Show the modal
        alertModal.classList.add('active');

        // Close modal when button is clicked
        alertButton.onclick = function() {
          alertModal.classList.remove('active');
        };

        // Close modal when clicking outside
        alertModal.onclick = function(e) {
          if (e.target === alertModal) {
            alertModal.classList.remove('active');
          }
        };

        // Close with Escape key
        document.addEventListener('keydown', function(e) {
          if (e.key === 'Escape' && alertModal.classList.contains('active')) {
            alertModal.classList.remove('active');
          }
        });
      }

      // Validation Functions
      function validateRouteSection() {
        const terminal = document.getElementById('terminal').value;
        const destination = document.getElementById('destination').value;
        const date = document.getElementById('date').value;
        const time = document.getElementById('time').value;

        if (!terminal || !destination) {
          showAlert('Please select both terminal and destination');
          return false;
        }

        if (terminal === destination) {
          showAlert('Departure and destination cannot be the same');
          return false;
        }

        if (!date) {
          showAlert('Please select a travel date');
          return false;
        }

        if (!time) {
          showAlert('Please select a travel time');
          return false;
        }

        return true;
      }

      function validatePassengerSection() {
        if (passengerCount < 1) {
          showAlert('Please select at least one passenger');
          return false;
        }
        return true;
      }

      // Update Summary
      function updateSummary() {
        const destinationSelect = document.getElementById('destination');
        const selectedOption = destinationSelect.options[destinationSelect.selectedIndex];
        const baseFare = parseFloat(selectedOption.getAttribute('data-fare')) || 0;

        const totalBaseFare = baseFare * passengerCount;
        const baggageFee = BAGGAGE_FEE_PER_KG * baggageCount;
        const discount = discountCheckbox.checked ? DISCOUNT_PER_PASSENGER * discountedPassengerCount : 0;
        const total = totalBaseFare + baggageFee + SERVICE_FEE - discount;
        const downpayment = Math.ceil(total * 0.5);

        // Update booking summary
        document.getElementById('base-fare-display').textContent = `₱${totalBaseFare.toFixed(2)}`;
        document.getElementById('baggage-fee-display').textContent = `₱${baggageFee.toFixed(2)}`;
        document.getElementById('total-fare-display').textContent = `₱${(totalBaseFare + baggageFee + SERVICE_FEE).toFixed(2)}`;

        // Update payment summary
        document.getElementById('total-fare').textContent = `₱${(totalBaseFare + baggageFee).toFixed(2)}`;
        document.getElementById('discount-amount').textContent = `-₱${discount.toFixed(2)}`;
        document.getElementById('amount-to-pay').textContent = `₱${downpayment.toFixed(2)}`;
      }



      // Update Philippines time every second
      function updatePhilippinesTime() {
        const now = new Date();
        const options = {
          timeZone: 'Asia/Manila',
          hour: '2-digit',
          minute: '2-digit',
          hour12: true
        };
        const timeString = now.toLocaleTimeString('en-US', options);
        document.getElementById('philippines-time').textContent = timeString;
      }

      setInterval(updatePhilippinesTime, 1000);
      updatePhilippinesTime();
    });
  </script>
</body>

</html>